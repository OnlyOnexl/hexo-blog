<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Helmæ¨¡æ¿å¼€å‘, love">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>Helmæ¨¡æ¿å¼€å‘ | love</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">love</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>é¦–é¡µ</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>æ ‡ç­¾</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>åˆ†ç±»</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>å½’æ¡£</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>å…³äº</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>ç•™è¨€æ¿</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>å‹æƒ…é“¾æ¥</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="æœç´¢" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">love</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			é¦–é¡µ
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			æ ‡ç­¾
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			åˆ†ç±»
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			å½’æ¡£
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			å…³äº
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			ç•™è¨€æ¿
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			å‹æƒ…é“¾æ¥
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/blinkfox/hexo-theme-matery" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/blinkfox/hexo-theme-matery" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/21.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">Helmæ¨¡æ¿å¼€å‘</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- æ–‡ç« å†…å®¹è¯¦æƒ… -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/k8s/">
                                <span class="chip bg-color">k8s</span>
                            </a>
                        
                            <a href="/tags/helm/">
                                <span class="chip bg-color">helm</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/k8s/" class="post-category">
                                k8s
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>å‘å¸ƒæ—¥æœŸ:&nbsp;&nbsp;
                    2022-04-10
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="Helmæ¨¡æ¿å¼€å‘"><a href="#Helmæ¨¡æ¿å¼€å‘" class="headerlink" title="Helmæ¨¡æ¿å¼€å‘"></a>Helmæ¨¡æ¿å¼€å‘</h2><p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220405193525884.png" alt="image-20220405193525884"></p>
<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><p>[TOC]</p>
<h2 id="1ã€å†…ç½®å¯¹è±¡"><a href="#1ã€å†…ç½®å¯¹è±¡" class="headerlink" title="1ã€å†…ç½®å¯¹è±¡"></a>1ã€å†…ç½®å¯¹è±¡</h2><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº† Helm Chart çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µå’Œä½¿ç”¨ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é‡ç‚¹ä»‹ç»ä¸‹ Chart æ¨¡æ¿çš„ç¼–å†™ã€‚æ¨¡æ¿ä¼šæ¸²æŸ“æˆ Kubernetes çš„èµ„æºæ¸…å•æ–‡ä»¶ï¼Œä¸‹é¢æˆ‘ä»¬å°†æ¥å­¦ä¹ ä¸‹æ¨¡æ¿çš„ç»“æ„ï¼Œå¦‚ä½•ä½¿ç”¨å®ƒä»¬ï¼Œå¦‚ä½•ç¼–å†™ Go æ¨¡æ¿ä»¥åŠå¦‚ä½•è°ƒè¯•ã€‚</p>
<p>å¯¹è±¡ä»<strong>æ¨¡æ¿å¼•æ“</strong>ä¼ é€’åˆ°æ¨¡æ¿ä¸­ï¼Œåœ¨ä»£ç ä¸­å¯ä»¥ä¼ é€’å¯¹è±¡ã€‚ä¹Ÿæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥åœ¨æ¨¡æ¿å®åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œæ¯”å¦‚ <code>tuple</code> å‡½æ•°ã€‚å¯¹è±¡å¯ä»¥å¾ˆç®€å•ï¼Œä¹Ÿå¯ä»¥åŒ…å«å…¶ä»–å¯¹è±¡æˆ–å‡½æ•°ï¼Œä¾‹å¦‚ï¼ŒRelease å¯¹è±¡å°±åŒ…å«å‡ ä¸ªå¯¹è±¡ï¼ˆæ¯”å¦‚ Release.Nameï¼‰ï¼ŒFiles å¯¹è±¡å°±åŒ…å«å‡ ä¸ªå‡½æ•°ã€‚</p>
<p>å‰é¢æåˆ°è¿‡æˆ‘ä»¬å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ <code>&#123;&#123; .Release.Name &#125;&#125;</code> è·å– release çš„åç§°ï¼ŒRelease æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨æ¨¡æ¿ä¸­è®¿é—®çš„å‡ ä¸ªé¡¶çº§å¯¹è±¡ä¹‹ä¸€ï¼š</p>
<ul>
<li><code>Release</code>ï¼šè¯¥å¯¹è±¡æè¿°äº† release æœ¬èº«çš„ç›¸å…³ä¿¡æ¯ï¼Œå®ƒå†…éƒ¨æœ‰å‡ ä¸ªå¯¹è±¡ï¼š<ul>
<li><code>Release.Name</code>ï¼šrelease åç§°</li>
<li><code>Release.Namespace</code>ï¼šrelease å®‰è£…åˆ°çš„å‘½åç©ºé—´</li>
<li><code>Release.IsUpgrade</code>ï¼šå¦‚æœå½“å‰æ“ä½œæ˜¯å‡çº§æˆ–å›æ»šï¼Œåˆ™è¯¥å€¼ä¸º true</li>
<li><code>Release.IsInstall</code>ï¼šå¦‚æœå½“å‰æ“ä½œæ˜¯å®‰è£…ï¼Œåˆ™å°†å…¶è®¾ç½®ä¸º true</li>
<li><code>Release.Revision</code>ï¼šrelease çš„ revision ç‰ˆæœ¬å·ï¼Œåœ¨å®‰è£…çš„æ—¶å€™ï¼Œå€¼ä¸º1ï¼Œæ¯æ¬¡å‡çº§æˆ–å›æ»šéƒ½ä¼šå¢åŠ </li>
<li><code>Reelase.Service</code>ï¼š<strong>æ¸²æŸ“å½“å‰æ¨¡æ¿çš„æœåŠ¡ï¼Œåœ¨ Helm ä¸Šï¼Œå®é™…ä¸Šè¯¥å€¼å§‹ç»ˆä¸º Helm</strong></li>
</ul>
</li>
<li><code>Values</code>ï¼šä» <code>values.yaml</code> æ–‡ä»¶å’Œç”¨æˆ·æä¾›çš„ values æ–‡ä»¶ä¼ é€’åˆ°æ¨¡æ¿çš„ Values å€¼ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒValues æ˜¯ç©ºçš„ã€‚</li>
<li><code>Chart</code>ï¼šè·å– <code>Chart.yaml</code> æ–‡ä»¶çš„å†…å®¹ï¼Œè¯¥æ–‡ä»¶ä¸­çš„ä»»ä½•æ•°æ®éƒ½å¯ä»¥è®¿é—®ï¼Œä¾‹å¦‚ <code>&#123;&#123; .Chart.Name &#125;&#125;-&#123;&#123; .Chart.Version&#125;&#125;</code> å¯ä»¥æ¸²æŸ“æˆ <code>mychart-0.1.0</code>ï¼Œè¯¥å¯¹è±¡ä¸‹é¢å¯ç”¨çš„å­—æ®µå‰é¢æˆ‘ä»¬å·²ç»æåˆ°è¿‡äº†ã€‚</li>
<li><code>Files</code>ï¼šå¯ä»¥è®¿é—® chart ä¸­çš„æ‰€æœ‰éç‰¹æ®Šæ–‡ä»¶ï¼Œè™½ç„¶æ— æ³•ä½¿ç”¨å®ƒæ¥è®¿é—®æ¨¡æ¿æ–‡ä»¶ï¼Œä½†æ˜¯å¯ä»¥æ¥è®¿é—® chart ä¸­çš„å…¶ä»–æ–‡ä»¶ã€‚<ul>
<li><code>Files.Get</code>ï¼šç”¨äºæ ¹æ®åç§°è·å–æ–‡ä»¶ï¼ˆæ¯”å¦‚ <code>.Files.Get config.ini</code>ï¼‰</li>
<li><code>Files.GetBytes</code>ï¼šç”¨äºä»¥ bytes æ•°ç»„è€Œä¸æ˜¯å­—ç¬¦ä¸²çš„å½¢å¼æ¥è·å–æ–‡ä»¶å†…å®¹çš„å‡½æ•°ï¼Œè¿™å¯¹äºç±»ä¼¼äºå›¾ç‰‡ä¹‹ç±»çš„ä¸œè¥¿å¾ˆæœ‰ç”¨</li>
<li><code>Files.Glob</code>ï¼šç”¨äºè¿”å›åç§°äºç»™å®šçš„ shell glob æ¨¡å¼åŒ¹é…çš„æ–‡ä»¶åˆ—è¡¨</li>
<li><code>Files.Lines</code>ï¼šå¯ä»¥é€è¡Œè¯»å–æ–‡ä»¶çš„å‡½æ•°ï¼Œå¯¹äºéå†æ–‡ä»¶ä¸­çš„æ¯è¡Œå†…å®¹å¾ˆæœ‰ç”¨</li>
<li><code>Files.AsSecrets</code>ï¼šå°†æ–‡ä»¶å†…å®¹ä»¥ Base64 ç¼–ç çš„å­—ç¬¦ä¸²è¿”å›çš„å‡½æ•°</li>
<li><code>Files.AsConfig</code>ï¼šå°†æ–‡ä»¶æ­£æ–‡ä½œä¸º YAML å­—å…¸è¿”å›çš„å‡½æ•°</li>
</ul>
</li>
<li><code>Capabilities</code>ï¼šæä¾›äº†è·å–æœ‰å…³ Kubernetes é›†ç¾¤æ”¯æŒåŠŸèƒ½çš„ä¿¡æ¯çš„å¯¹è±¡<ul>
<li><code>Capabilities.APIVersions</code>ï¼šæ”¯æŒçš„ç‰ˆæœ¬é›†åˆ</li>
<li><code>Capabilities.APIVersions.Has $version</code>ï¼šåˆ¤æ–­ä¸€ä¸ªç‰ˆæœ¬ï¼ˆæ¯”å¦‚ <code>batch/v1</code>ï¼‰æˆ–èµ„æºï¼ˆæ¯”å¦‚ <code>apps/v1/Deployment</code>ï¼‰æ˜¯å¦å¯ç”¨</li>
<li><code>Capabilities.Kube.Version</code>ï¼šKubernetes çš„ç‰ˆæœ¬</li>
<li><code>Capabilities.Kube</code>ï¼šæ˜¯ Kubernetes ç‰ˆæœ¬çš„ç¼©å†™</li>
<li><code>Capabilities.Kube.Major</code>ï¼šKubernetes ä¸»ç‰ˆæœ¬</li>
<li><code>Capabilities.Kube.Minor</code>ï¼šKubernetes çš„æ¬¡ç‰ˆæœ¬</li>
</ul>
</li>
<li><code>Template</code>ï¼šåŒ…å«å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ¨¡æ¿çš„ç›¸å…³ä¿¡æ¯<ul>
<li><code>Name</code>ï¼šå½“å‰æ¨¡æ¿çš„å‘½åç©ºé—´æ–‡ä»¶è·¯å¾„ï¼ˆæ¯”å¦‚ <code>mychart/templates/mytemplate.yaml</code>ï¼‰</li>
<li><code>BaePath</code>ï¼šå½“å‰ chart çš„æ¨¡æ¿ç›®å½•çš„å‘½åç©ºé—´è·¯å¾„ï¼ˆæ¯”å¦‚ <code>mychart/templates</code>ï¼‰</li>
</ul>
</li>
</ul>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯å†…ç½®çš„å¯¹è±¡å§‹ç»ˆæ˜¯ä»¥å¤§å†™å­—æ¯å¼€å¤´çš„ï¼Œè¿™ä¹Ÿæ˜¯ç¬¦åˆ Go çš„å‘½åçº¦å®šçš„ã€‚åˆ›å»ºè‡ªå·±çš„åç§°çš„æ—¶å€™ï¼Œå¯ä»¥è‡ªç”±ä½¿ç”¨é€‚åˆä½ å›¢é˜Ÿçš„çº¦å®šï¼Œä¸€äº›å›¢é˜Ÿï¼Œæ¯”å¦‚ Kubernetes Charts å›¢é˜Ÿï¼Œé€‰æ‹©ä»…ä½¿ç”¨é¦–å­—æ¯å°å†™ï¼Œä»¥åŒºåˆ†æœ¬åœ°åç§°å’Œå†…ç½®åç§°ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿä¼šéµå¾ªè¯¥çº¦å®šã€‚</p>
</blockquote>
<h2 id="2ã€Values-æ–‡ä»¶"><a href="#2ã€Values-æ–‡ä»¶" class="headerlink" title="2ã€Values æ–‡ä»¶"></a>2ã€Values æ–‡ä»¶</h2><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº† Helm æ¨¡æ¿æä¾›çš„å†…ç½®å¯¹è±¡ï¼Œå…¶ä¸­å°±æœ‰ä¸€ä¸ªå†…ç½®å¯¹è±¡ <code>Values</code>ï¼Œè¯¥å¯¹è±¡æä¾›å¯¹ä¼ é€’åˆ° chart ä¸­çš„ values å€¼çš„è®¿é—®ï¼Œå…¶å†…å®¹ä¸»è¦æœ‰4ä¸ªæ¥æºï¼š</p>
<ul>
<li>chart æ–‡ä»¶ä¸­çš„ <code>values.yaml</code> æ–‡ä»¶</li>
<li>å¦‚æœè¿™æ˜¯å­ chartï¼Œçˆ¶ chart çš„ <code>values.yaml</code> æ–‡ä»¶</li>
<li>ç”¨ <code>-f</code> å‚æ•°ä¼ é€’ç»™ <code>helm install</code> æˆ– <code>helm upgrade</code> çš„ values å€¼æ–‡ä»¶ï¼ˆä¾‹å¦‚ <code>helm install -f myvals.yaml ./mychart</code>ï¼‰</li>
<li>ç”¨ <code>--set</code> ä¼ é€’çš„å„ä¸ªå‚æ•°ï¼ˆä¾‹å¦‚ <code>helm install --set foo=bar ./mychart</code>ï¼‰</li>
</ul>
<p><code>values.yaml</code> æ–‡ä»¶æ˜¯é»˜è®¤å€¼ï¼Œå¯ä»¥è¢«çˆ¶ chart çš„ <code>values.yaml</code> æ–‡ä»¶è¦†ç›–ï¼Œè€Œåè€…åˆå¯ä»¥ç”±ç”¨æˆ·æä¾›çš„ values å€¼æ–‡ä»¶è¦†ç›–ï¼Œè€Œè¯¥æ–‡ä»¶åˆå¯ä»¥è¢« <code>--set</code> å‚æ•°è¦†ç›–ã€‚</p>
<h3 id="1-chartæ¨¡æ¿ç¼–å†™"><a href="#1-chartæ¨¡æ¿ç¼–å†™" class="headerlink" title="1.chartæ¨¡æ¿ç¼–å†™"></a>1.chartæ¨¡æ¿ç¼–å†™</h3><table><tr><td bgcolor=yellow>ğŸ’˜ æ¼”ç¤ºï¼šchartæ¨¡æ¿ç¼–å†™-2022.4.5(æµ‹è¯•æˆåŠŸ)</td></tr></table>

<p>1ï¸âƒ£ åˆ›å»ºchartsåŒ…</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220405200123037.png" alt="image-20220405200123037"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">âœ  ~ helm create mychart</span><br><span class="line">Creating mychart</span><br><span class="line"></span><br><span class="line">âœ  ~ tree mychart </span><br><span class="line">mychart</span><br><span class="line">â”œâ”€â”€ charts</span><br><span class="line">â”œâ”€â”€ Chart.yaml</span><br><span class="line">â”œâ”€â”€ templates</span><br><span class="line">â”‚   â”œâ”€â”€ deployment.yaml</span><br><span class="line">â”‚   â”œâ”€â”€ _helpers.tpl</span><br><span class="line">â”‚   â”œâ”€â”€ hpa.yaml</span><br><span class="line">â”‚   â”œâ”€â”€ ingress.yaml</span><br><span class="line">â”‚   â”œâ”€â”€ NOTES.txt</span><br><span class="line">â”‚   â”œâ”€â”€ serviceaccount.yaml</span><br><span class="line">â”‚   â”œâ”€â”€ service.yaml</span><br><span class="line">â”‚   â””â”€â”€ tests</span><br><span class="line">â”‚       â””â”€â”€ test-connection.yaml</span><br><span class="line">â””â”€â”€ values.yaml</span><br><span class="line"></span><br><span class="line">3 directories, 10 files</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¸…ç©º<code>values.yaml</code>æ–‡ä»¶å†…å®¹ï¼Œåˆ é™¤<code>templatesç›®å½•</code>ä¸‹å†…å®¹ï¼š</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220405200709182.png" alt="image-20220405200709182"></p>
<p>2ï¸âƒ£ åˆ›å»ºæ¨¡æ¿æ–‡ä»¶</p>
<p>å¸¸è§„yamlæ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<p>åœ¨<code>mychart/templatesç›®å½•</code>ä¸‹åˆ›å»º<code>ConfigMap.yamlæ–‡ä»¶</code>ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">myconfigmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">test:</span> <span class="string">helm-chart</span></span><br></pre></td></tr></table></figure>

<p>ç„¶åç›´æ¥ä½¿ç”¨<code>helm template mychart1 ./mychart</code>å‘½ä»¤ç›´æ¥æ¸²æŸ“ï¼Œæˆ‘ä»¬çœ‹ä¸‹ç»“æœï¼š</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220405201646775.png" alt="image-20220405201646775"></p>
<p>3ï¸âƒ£ ç¼–è¾‘æ¨¡æ¿æ–‡ä»¶</p>
<ul>
<li>values å€¼æ–‡ä»¶æ˜¯çº¯ YAML æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ¥ç¼–è¾‘ <code>mychart/values.yaml</code> æ–‡ä»¶ç„¶åç¼–è¾‘ <code>ConfigMap</code> æ¨¡æ¿ã€‚åˆ é™¤ <code>values.yaml</code> ä¸­çš„é»˜è®¤è®¾ç½®åï¼Œæˆ‘ä»¬å°†åªè®¾ç½®ä¸€ä¸ªå‚æ•°ï¼š</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">favoriteDrink:</span> <span class="string">coffee</span></span><br></pre></td></tr></table></figure>



<ul>
<li>ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨æ¨¡æ¿ä¸­ç›´æ¥ä½¿ç”¨å®ƒï¼Œè¿™é‡Œç¼–è¾‘ä¸‹<code>ConfigMap.yamlæ–‡ä»¶</code>ï¼š</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favoriteDrink</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°åœ¨æœ€åä¸€è¡Œæˆ‘ä»¬å°† <code>favoriteDrink</code> ä½œä¸º <code>Values</code> çš„å±æ€§è¿›è¡Œè®¿é—®ï¼š<code>&#123;&#123; .Values.favoriteDrink &#125;&#125;</code>ã€‚</p>
<ul>
<li>æˆ‘ä»¬å¯ä»¥æ¥çœ‹çœ‹æ˜¯å¦‚ä½•æ¸²æŸ“çš„ï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#âœ helm install --generate-name --dry-run --debug ./mychart</span></span><br><span class="line">âœ  helm install --generate-name --dry-run ./mychart <span class="comment">#æ³¨æ„è¿™é‡Œçš„--dry-runå‚æ•°ï¼šsimulate an install</span></span><br><span class="line">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/hg/.kube/config</span><br><span class="line">WARNING: Kubernetes configuration file is world-readable. This is insecure. Location: /home/hg/.kube/config</span><br><span class="line">NAME: mychart-1649168183</span><br><span class="line">LAST DEPLOYED: Tue Apr  5 22:16:24 2022</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: pending-install</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">HOOKS:</span><br><span class="line">MANIFEST:</span><br><span class="line">---</span><br><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: mychart-1649168183-configmap</span><br><span class="line">data:</span><br><span class="line">  myvalue: <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  drink: coffee</span><br></pre></td></tr></table></figure>

<p>:warning: æ³¨æ„ï¼šè¿™é‡Œå¦‚æœä½¿ç”¨<code>templateå‘½ä»¤</code>çš„è¯ï¼ŒåŒæ—¶ä½¿ç”¨<code>--generate-name</code>é€‰é¡¹ï¼Œä¼šæ²¡æœ‰æ•ˆæœï¼Œå»ºè®®ç›´æ¥ä½¿ç”¨<code>--dry-run</code>é€‰é¡¹ï¼›</p>
<p>å› ä¸º<code>--dry-run</code>æ˜¯æ¨¡æ‹Ÿå®‰è£…ï¼Œè€Œ<code>templateå‘½ä»¤</code>åªæ¸²æŸ“ï¼Œå¯èƒ½ä¼šæœ‰ç‚¹é—®é¢˜ï¼</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220406083704283.png" alt="image-20220406083704283"></p>
<p>4ï¸âƒ£ ä½¿ç”¨<code>--set</code> å‚æ•°æ¥è¦†ç›–é»˜è®¤vaulueså€¼</p>
<ul>
<li>ç”±äºåœ¨é»˜è®¤çš„ <code>values.yaml</code> æ–‡ä»¶ä¸­å°† favoriteDrink è®¾ç½®ä¸ºäº† coffeeï¼Œæ‰€ä»¥è¿™å°±æ˜¯æ¨¡æ¿ä¸­æ˜¾ç¤ºçš„å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨è°ƒç”¨ <code>helm install</code> çš„è¿‡ç¨‹ä¸­æ·»åŠ  <code>--set</code> å‚æ•°æ¥è¦†ç›–å®ƒï¼š</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#æŸ¥çœ‹ä¸‹values.yamlæ–‡ä»¶å†…å®¹</span></span><br><span class="line">favoriteDrink: coffee</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨`--set` å‚æ•°æ¥è¦†ç›–é»˜è®¤vaulueså€¼</span></span><br><span class="line">âœ helm install --generate-name --<span class="built_in">set</span> favoriteDrink=xyy --dry-run ./mychart </span><br><span class="line">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/hg/.kube/config</span><br><span class="line">WARNING: Kubernetes configuration file is world-readable. This is insecure. Location: /home/hg/.kube/config</span><br><span class="line">NAME: mychart-1649205876</span><br><span class="line">LAST DEPLOYED: Wed Apr  6 08:44:37 2022</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: pending-install</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">HOOKS:</span><br><span class="line">MANIFEST:</span><br><span class="line">---</span><br><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: mychart-1649205876-configmap</span><br><span class="line">data:</span><br><span class="line">  myvalue: <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  drink: xyy</span><br></pre></td></tr></table></figure>

<p>å› ä¸º <code>--set</code> çš„ä¼˜å…ˆçº§é«˜äºé»˜è®¤çš„ <code>values.yaml</code> æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ¨¡æ¿ä¼šç”Ÿæˆ <code>drink: slurm</code>ã€‚</p>
<p>5ï¸âƒ£ Values å€¼æ–‡ä»¶ä¹Ÿå¯ä»¥åŒ…å«æ›´å¤šç»“æ„åŒ–çš„å†…å®¹</p>
<ul>
<li>Values å€¼æ–‡ä»¶ä¹Ÿå¯ä»¥åŒ…å«æ›´å¤šç»“æ„åŒ–çš„å†…å®¹ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥åœ¨ <code>values.yaml</code> æ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ª favorite çš„éƒ¨åˆ†ï¼Œç„¶ååœ¨å…¶ä¸­æ·»åŠ å‡ ä¸ª keysï¼š</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">favorite:</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">coffee</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">pizza</span></span><br></pre></td></tr></table></figure>



<ul>
<li>ç°åœ¨æˆ‘ä»¬å†å»ä¿®æ”¹ä¸‹æˆ‘ä»¬çš„æ¨¡æ¿<code>ConfigMap.yanl</code>ï¼š</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> &#125;&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>éªŒè¯</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">âœ  local-vscode helm install --generate-name --<span class="built_in">set</span> favoriteDrink=xyy --dry-run ./mychart </span><br><span class="line">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/hg/.kube/config</span><br><span class="line">WARNING: Kubernetes configuration file is world-readable. This is insecure. Location: /home/hg/.kube/config</span><br><span class="line">NAME: mychart-1649206046</span><br><span class="line">LAST DEPLOYED: Wed Apr  6 08:47:27 2022</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: pending-install</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">HOOKS:</span><br><span class="line">MANIFEST:</span><br><span class="line">---</span><br><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: mychart-1649206046-configmap</span><br><span class="line">data:</span><br><span class="line">  myvalue: <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  drink: coffee</span><br><span class="line">  food: pizza</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥æ„é€ æ•°æ®ï¼Œä½†æ˜¯è¿˜æ˜¯å»ºè®®ä½ å°† values æ ‘ä¿æŒæ›´æµ…ï¼Œè¿™æ ·åœ¨ä½¿ç”¨çš„æ—¶å€™æ›´åŠ ç®€å•ã€‚<strong>å½“æˆ‘ä»¬è€ƒè™‘ä¸ºå­ chart åˆ†é… values å€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°å¦‚ä½•ä½¿ç”¨æ ‘å½¢ç»“æ„æ¥å‘½å values å€¼äº†</strong>ã€‚</p>
<p>æµ‹è¯•ç»“æŸã€‚ğŸ˜‹</p>
<h3 id="2-åˆ é™¤é»˜è®¤-KEY"><a href="#2-åˆ é™¤é»˜è®¤-KEY" class="headerlink" title="2.åˆ é™¤é»˜è®¤ KEY"></a>2.åˆ é™¤é»˜è®¤ KEY</h3><p>å¦‚æœä½ éœ€è¦ä»é»˜è®¤å€¼ä¸­åˆ é™¤ keyï¼Œåˆ™å¯ä»¥å°†è¯¥ key çš„å€¼è¦†ç›–ä¸º nullï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒHelm å°†ä»è¦†ç›–çš„ values ä¸­åˆ é™¤è¯¥ keyã€‚ä¾‹å¦‚ï¼Œåœ¨ Drupal chart ä¸­é…ç½®ä¸€ä¸ª liveness æ¢é’ˆ:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">livenessProbe:</span></span><br><span class="line">  <span class="attr">httpGet:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/user/login</span></span><br><span class="line">    <span class="attr">port:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">initialDelaySeconds:</span> <span class="number">120</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æƒ³ä½¿ç”¨ <code>--set livenessProbe.exec.command=[cat, docroot/CHANGELOG.txt]</code> å°† livenessProbe çš„å¤„ç†ç¨‹åºè¦†ç›–ä¸º <code>exec</code> è€Œä¸æ˜¯ <code>httpGet</code>ï¼Œåˆ™ Helm ä¼šå°†é»˜è®¤é”®å’Œè¦†ç›–é”®åˆå¹¶åœ¨ä¸€èµ·ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">livenessProbe:</span></span><br><span class="line">  <span class="attr">httpGet:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/user/login</span></span><br><span class="line">    <span class="attr">port:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">exec:</span></span><br><span class="line">    <span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">docroot/CHANGELOG.txt</span></span><br><span class="line">  <span class="attr">initialDelaySeconds:</span> <span class="number">120</span></span><br></pre></td></tr></table></figure>



<p>ä½†æ˜¯ï¼Œè¿™æ ·å´æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºä½ ä¸èƒ½å£°æ˜å¤šä¸ª livenessProbe å¤„ç†ç¨‹åºï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥è®© Helm é€šè¿‡å°† <code>livenessProbe.httpGet</code> è®¾ç½®ä¸º null æ¥åˆ é™¤å®ƒï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">âœ helm install stable/drupal --<span class="built_in">set</span> image=my-registry/drupal:0.1.0 --<span class="built_in">set</span> livenessProbe.exec.command=[cat, docroot/CHANGELOG.txt] --<span class="built_in">set</span> livenessProbe.httpGet=null</span><br></pre></td></tr></table></figure>

<p>åˆ°è¿™é‡Œæˆ‘ä»¬å·²ç»äº†è§£åˆ°äº†å‡ ä¸ªå†…ç½®å¯¹è±¡ï¼Œå¹¶åˆ©ç”¨å®ƒä»¬å°†ä¿¡æ¯æ³¨å…¥åˆ°äº†æ¨¡æ¿ä¸­ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹æ¨¡æ¿å¼•æ“çš„å¦å¤–æ–¹é¢ï¼š<strong>å‡½æ•°å’Œç®¡é“</strong>ã€‚</p>
<h2 id="3ã€å‡½æ•°å’Œç®¡é“"><a href="#3ã€å‡½æ•°å’Œç®¡é“" class="headerlink" title="3ã€å‡½æ•°å’Œç®¡é“"></a>3ã€å‡½æ•°å’Œç®¡é“</h2><p>ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä½•å°†ä¿¡æ¯åŠ å…¥åˆ°æ¨¡æ¿ä¸­ï¼Œä½†æ˜¯è¿™äº›ä¿¡æ¯éƒ½æ˜¯ç›´æ¥åŸæ ·çš„æ”¾ç½®è¿‡å»çš„ï¼Œæœ‰æ—¶å€™ï¼Œ<strong>æˆ‘ä»¬å¸Œæœ›ä»¥ä¸€ç§å¯¹æˆ‘ä»¬æ›´æœ‰ç”¨çš„æ–¹å¼æ¥è½¬æ¢æä¾›çš„æ•°æ®</strong>ã€‚</p>
<p>ä¸‹é¢è®©æˆ‘ä»¬ä»ä¸€ä¸ªæœ€ä½³å®è·µå¼€å§‹ï¼šå°† <code>.Values</code> å¯¹è±¡ä¸­çš„å­—ç¬¦ä¸²æ³¨å…¥æ¨¡æ¿æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å¼•ç”¨è¿™äº›å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨ template æŒ‡ä»¤ä¸­è°ƒç”¨ <code>quote</code> å‡½æ•°æ¥å®ç°ï¼Œæ¯”å¦‚ï¼š</p>
<table><tr><td bgcolor=yellow>ğŸ’˜ æ¼”ç¤ºï¼šæµ‹è¯•quoteå‡½æ•°-2022.4.5(æµ‹è¯•æˆåŠŸ)</td></tr></table>

<ol>
<li><p>ç¼–è¾‘<code>ConfigMap.yaml</code>ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">quote</span> <span class="string">.Values.favorite.drink</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æ¨¡æ¿å‡½æ•°éµå¾ªçš„è¯­æ³•è§„åˆ™æ˜¯ <code>functionName arg1 arg2...</code>ï¼Œåœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œ<code>quote .Values.favorite.drink</code> ä¼šè°ƒç”¨ <code>quote</code> å‡½æ•°å¹¶ä¼ é€’ä¸€ä¸ªå•ä¸ªå‚æ•°ã€‚</p>
</li>
<li><p>æµ‹è¯•</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">âœ</span>  <span class="string">local-vscode</span> <span class="string">helm</span> <span class="string">install</span> <span class="string">--generate-name</span> <span class="string">--dry-run</span> <span class="string">./mychart</span></span><br><span class="line"><span class="attr">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location:</span> <span class="string">/home/hg/.kube/config</span></span><br><span class="line"><span class="attr">WARNING: Kubernetes configuration file is world-readable. This is insecure. Location:</span> <span class="string">/home/hg/.kube/config</span></span><br><span class="line"><span class="attr">NAME:</span> <span class="string">mychart-1649221072</span></span><br><span class="line"><span class="attr">LAST DEPLOYED:</span> <span class="string">Wed</span> <span class="string">Apr</span>  <span class="number">6</span> <span class="number">12</span><span class="string">:57:53</span> <span class="number">2022</span></span><br><span class="line"><span class="attr">NAMESPACE:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">STATUS:</span> <span class="string">pending-install</span></span><br><span class="line"><span class="attr">REVISION:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">TEST SUITE:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">HOOKS:</span></span><br><span class="line"><span class="attr">MANIFEST:</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1649221072-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">pizza</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¯ä»¥çœ‹åˆ°<code>quote</code>å‡½æ•°å°±æ˜¯ç»™åé¢åŠ ä¸Šä¸€å¯¹<code>&quot;</code>ç¬¦å·ã€‚</p>
</blockquote>
</li>
</ol>
<p>æµ‹è¯•ç»“æŸã€‚ğŸ˜˜</p>
<p>ğŸ€ <code>Helmæ¨¡æ¿è¯­è¨€</code></p>
<p>Helm æœ‰60å¤šç§å¯ç”¨çš„å‡½æ•°ï¼Œå…¶ä¸­ä¸€äº›æ˜¯ç”± <a target="_blank" rel="noopener" href="https://godoc.org/text/template">Go æ¨¡æ¿è¯­è¨€</a>æœ¬èº«å®šä¹‰çš„ï¼Œå…¶ä»–å¤§å¤šæ•°éƒ½æ˜¯ <a target="_blank" rel="noopener" href="https://masterminds.github.io/sprig/">Sprig æ¨¡æ¿åº“</a>æä¾›çš„ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šé€šè¿‡éƒ¨åˆ†ç¤ºä¾‹æ¥é€æ­¥ä»‹ç»å…¶ä¸­çš„ä¸€äº›åŠŸèƒ½å‡½æ•°ã€‚</p>
<blockquote>
<p>:warning: Helm æ¨¡æ¿</p>
<p>å½“æˆ‘ä»¬è°ˆè®º <code>Helm æ¨¡æ¿è¯­è¨€</code> çš„æ—¶å€™ï¼Œå°±å¥½åƒæ˜¯ç‰¹å®šäº Helm ä¸€æ ·ï¼Œä½†å®é™…ä¸Šå®ƒæ˜¯ Go æ¨¡æ¿è¯­è¨€åŠ ä¸Šä¸€äº›é¢å¤–çš„å‡½æ•°ä»¥åŠå„ç§å°è£…ç¨‹åºçš„ç»„åˆï¼Œä»¥å°†æŸäº›å¯¹è±¡æš´éœ²ç»™æ¨¡æ¿ã€‚å½“æˆ‘ä»¬éœ€è¦å­¦ä¹ æ¨¡æ¿çš„æ—¶å€™ï¼ŒGo æ¨¡æ¿ä¸Šæœ‰è®¸å¤šèµ„æºä¼šå¯¹æˆ‘ä»¬æœ‰æ‰€å¸®åŠ©çš„ã€‚</p>
</blockquote>
<h3 id="1-ç®¡é“"><a href="#1-ç®¡é“" class="headerlink" title="1.ç®¡é“"></a>1.ç®¡é“</h3><p>æ¨¡æ¿è¯­è¨€æœ‰ä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½å°±æ˜¯<strong>ç®¡é“ï¼ˆPipelineï¼‰</strong>æ¦‚å¿µï¼Œç®¡é“åˆ©ç”¨ UNIX çš„æ¦‚å¿µï¼Œå°†ä¸€ç³»åˆ—æ¨¡æ¿å‘½ä»¤é“¾æ¥åœ¨ä¸€èµ·ï¼Œä¸€èµ·å¯¹å¤–æä¾›æœåŠ¡ï¼Œæ¢å¥è¯è¯´ï¼Œ<strong>ç®¡é“æ˜¯æŒ‰é¡ºåºå®Œæˆå¤šé¡¹å·¥ä½œçš„æœ‰æ•ˆæ–¹å¼</strong>ã€‚</p>
<table><tr><td bgcolor=yellow>ğŸ’˜ æ¼”ç¤ºï¼šæµ‹è¯•ç®¡é“-2022.4.5(æµ‹è¯•æˆåŠŸ)</td></tr></table>

<p>1ï¸âƒ£ æˆ‘ä»¬æ¥ä½¿ç”¨ç®¡é“é‡å†™ä¸Šé¢çš„ç¤ºä¾‹æ¨¡æ¿ï¼šç¼–è¾‘<code>ConfigMap.yaml</code>æ–‡ä»¶</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br></pre></td></tr></table></figure>



<p>2ï¸âƒ£ åœ¨è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰è°ƒç”¨ <code>quote ARGUMENT</code> å‡½æ•°ï¼Œè€Œæ˜¯é¢ å€’äº†ä¸‹é¡ºåºï¼Œæˆ‘ä»¬ä½¿ç”¨ç®¡é“ç¬¦ï¼ˆ|ï¼‰å°†å‚æ•°<strong>å‘é€</strong>ç»™å‡½æ•°ï¼š<code>.Values.favorite.drink | quote</code>ï¼Œä½¿ç”¨ç®¡é“ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¤šä¸ªåŠŸèƒ½é“¾æ¥åœ¨ä¸€èµ·ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç®¡é“é¡ºåº</p>
<blockquote>
<p>åè½¬é¡ºåºæ˜¯æ¨¡æ¿ä¸­å¸¸è§çš„åšæ³•ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ° <code>.val | quote</code> æ¯” <code>quote .val</code> ç”¨æ³•æ›´å¤šï¼Œè™½ç„¶ä¸¤ç§æ–¹æ³•éƒ½æ˜¯å¯ä»¥çš„ã€‚</p>
</blockquote>
<p>3ï¸âƒ£ æœ€åï¼Œæ¨¡æ¿æ¸²æŸ“åï¼Œä¼šäº§ç”Ÿå¦‚ä¸‹æ‰€ç¤ºçš„ç»“æœï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">âœ</span>  <span class="string">local-vscode</span> <span class="string">helm</span> <span class="string">install</span> <span class="string">--generate-name</span> <span class="string">--dry-run</span> <span class="string">./mychart</span></span><br><span class="line"><span class="attr">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location:</span> <span class="string">/home/hg/.kube/config</span></span><br><span class="line"><span class="attr">WARNING: Kubernetes configuration file is world-readable. This is insecure. Location:</span> <span class="string">/home/hg/.kube/config</span></span><br><span class="line"><span class="attr">NAME:</span> <span class="string">mychart-1649225993</span></span><br><span class="line"><span class="attr">LAST DEPLOYED:</span> <span class="string">Wed</span> <span class="string">Apr</span>  <span class="number">6</span> <span class="number">14</span><span class="string">:19:54</span> <span class="number">2022</span></span><br><span class="line"><span class="attr">NAMESPACE:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">STATUS:</span> <span class="string">pending-install</span></span><br><span class="line"><span class="attr">REVISION:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">TEST SUITE:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">HOOKS:</span></span><br><span class="line"><span class="attr">MANIFEST:</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1649225993-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;PIZZA&quot;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° values ä¸­çš„ <code>pizza</code> å€¼å·²ç»è¢«è½¬æ¢æˆäº† <code>&quot;PIZZA&quot;</code>ã€‚å½“è¿™æ ·ä¼ é€’å‚æ•°çš„æ—¶å€™ï¼Œç¬¬ä¸€ä¸ªæ±‚å€¼ç»“æœï¼ˆ<code>.Values.favorite.drink</code>ï¼‰ä¼šä½œä¸ºä¸€ä¸ªå‚æ•°å‘é€ç»™å‡½æ•°ã€‚</p>
<p>4ï¸âƒ£ æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸Šé¢çš„ <code>drink</code> ç¤ºä¾‹ï¼Œç”¨ä¸€ä¸ªå¸¦æœ‰ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°è¿›è¡Œè¯´æ˜ï¼š<code>repeat COUNT STRING</code>ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> <span class="string">|</span> <span class="string">repeat</span> <span class="number">5</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p><code>repeat</code> å‡½æ•°å°†é‡å¤å­—ç¬¦ä¸²ç»™å®šçš„æ¬¡æ•°ï¼Œæ¸²æŸ“åæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„è¾“å‡ºç»“æœï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">âœ</span>  <span class="string">local-vscode</span> <span class="string">helm</span> <span class="string">install</span> <span class="string">--generate-name</span> <span class="string">--dry-run</span> <span class="string">./mychart</span></span><br><span class="line"><span class="string">â€¦â€¦</span></span><br><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1649226152-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffeecoffeecoffeecoffeecoffee&quot;</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;PIZZA&quot;</span></span><br></pre></td></tr></table></figure>

<p>:warning: è¿™é‡Œéœ€è¦æ³¨æ„ä¸‹ï¼šè¿™ä¸ª<code>repeat 5</code>è¦æ”¾åœ¨å‰é¢å—ï¼Œä¸ä¼šä¼šæŠ¥é”™ï¼Œæ”¾åœ¨åé¢çš„è¯ï¼Œå› ä¸ºæ˜¯ä¸æ»¡è¶³yamlæ ¼å¼çš„ã€‚</p>
<img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220406142658814.png" alt="image-20220406142658814"  />

<p>æµ‹è¯•ç»“æŸã€‚ğŸ˜˜</p>
<h3 id="2-default-å‡½æ•°"><a href="#2-default-å‡½æ•°" class="headerlink" title="2.default å‡½æ•°"></a>2.default å‡½æ•°</h3><p>åœ¨æ¨¡æ¿ä¸­ç»å¸¸ä¼šä½¿ç”¨åˆ°çš„ä¸€ä¸ªå‡½æ•°æ˜¯ <code>default</code> å‡½æ•°ï¼š<code>default DEFAULT_VALUE GIVEN_VALUE</code>ï¼Œè¯¥å‡½æ•°å…è®¸ä½ åœ¨æ¨¡æ¿å†…éƒ¨æŒ‡å®šé»˜è®¤å€¼ã€‚</p>
<table><tr><td bgcolor=yellow>ğŸ’˜ æ¼”ç¤ºï¼šæµ‹è¯•defaultå‡½æ•°-2022.4.5(æµ‹è¯•æˆåŠŸ)</td></tr></table>

<p>1ï¸âƒ£ æˆ‘ä»¬æ¥ä¿®æ”¹ä¸Šé¢ç¤ºä¾‹ä¸­çš„æ¨¡æ¿ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#è¿™é‡Œæ·»åŠ deafult &quot;rice&quot;</span></span><br><span class="line"><span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;rice&quot;</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#å®Œæ•´ConfigMap.yamlå†…å®¹å¦‚ä¸‹</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> <span class="string">|</span> <span class="string">repeat</span> <span class="number">5</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125; </span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;rice&quot;</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span>&#125;&#125;</span><br></pre></td></tr></table></figure>



<p>2ï¸âƒ£ æ­£å¸¸è¿è¡Œï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥å¾—åˆ° <code>values.yaml</code> æ–‡ä»¶ä¸­å®šä¹‰çš„ pizzaï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">âœ</span>  <span class="string">local-vscode</span> <span class="string">helm</span> <span class="string">install</span> <span class="string">--generate-name</span> <span class="string">--dry-run</span> <span class="string">./mychart</span></span><br><span class="line"><span class="string">â€¦â€¦</span></span><br><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1649226682-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffeecoffeecoffeecoffeecoffee&quot;</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;PIZZA&quot;</span></span><br></pre></td></tr></table></figure>



<p>3ï¸âƒ£ ç°åœ¨æˆ‘ä»¬ä» <code>values.yaml</code> æ–‡ä»¶ä¸­ç§»é™¤ food çš„å®šä¹‰ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">favorite:</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">coffee</span></span><br><span class="line">  <span class="comment"># food: pizza</span></span><br></pre></td></tr></table></figure>



<p>4ï¸âƒ£ ç°åœ¨æˆ‘ä»¬é‡æ–°è¿è¡Œ <code>helm install --generate-name --dry-run --debug ./mychart</code> å°†æ¸²æŸ“æˆå¦‚ä¸‹çš„ YAML æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">âœ</span>  <span class="string">local-vscode</span> <span class="string">helm</span> <span class="string">install</span> <span class="string">--generate-name</span> <span class="string">--dry-run</span> <span class="string">./mychart</span></span><br><span class="line"><span class="string">â€¦â€¦</span></span><br><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1649226830-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffeecoffeecoffeecoffeecoffee&quot;</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;RICE&quot;</span></span><br></pre></td></tr></table></figure>



<p>5ï¸âƒ£ :warning: æ³¨æ„</p>
<p>åœ¨ä¸€ä¸ªçœŸå®çš„ chart æ¨¡æ¿ä¸­ï¼Œæ‰€æœ‰çš„é™æ€é»˜è®¤å€¼éƒ½åº”ä½äº <code>values.yaml</code> æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸”ä¸åº”è¯¥é‡å¤ä½¿ç”¨ <code>default</code> å‡½æ•°ï¼Œä½†æ˜¯ï¼Œé»˜è®¤å‘½ä»¤éå¸¸é€‚åˆè®¡ç®—ä¸èƒ½åœ¨ <code>values.yaml</code> æ–‡ä»¶ä¸­å£°æ˜çš„ values å€¼ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">default</span> <span class="string">(printf</span> <span class="string">&quot;%s-rice&quot;</span> <span class="string">(include</span> <span class="string">&quot;fullname&quot;</span> <span class="string">.))</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸è¿‡åœ¨æœ‰äº›åœ°æ–¹ï¼Œ<code>if</code> æ¡ä»¶è¯­å¥å¯èƒ½æ¯” default å‡½æ•°æ›´åˆé€‚ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢äº†è§£åˆ°ã€‚</p>
<p>æ¨¡æ¿å‡½æ•°å’Œç®¡é“æ˜¯å°†æ•°æ®è½¬æ¢åç„¶åå°†å…¶æ’å…¥åˆ° YAML æ–‡ä»¶ä¸­çš„ä¸€ç§å¼ºå¤§æ–¹æ³•ï¼Œä½†æ˜¯æœ‰çš„æ—¶å€™æœ‰å¿…è¦æ·»åŠ ä¸€äº›<strong>æ¨¡æ¿é€»è¾‘</strong>ï¼Œè¿™äº›é€»è¾‘æ¯”ä»…ä»…æ’å…¥å­—ç¬¦ä¸²è¦å¤æ‚å¾—å¤šï¼Œä¸‹é¢æˆ‘ä»¬å°†æ¥äº†è§£æ¨¡æ¿è¯­è¨€ä¸­æä¾›çš„æ§åˆ¶æµç¨‹ã€‚</p>
<p>æµ‹è¯•ç»“æŸã€‚ğŸ˜˜</p>
<h3 id="3-è¿ç®—ç¬¦å‡½æ•°"><a href="#3-è¿ç®—ç¬¦å‡½æ•°" class="headerlink" title="3.è¿ç®—ç¬¦å‡½æ•°"></a>3.è¿ç®—ç¬¦å‡½æ•°</h3><p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯åœ¨æ¨¡æ¿ä¸­ï¼Œè¿ç®—ç¬¦ï¼ˆeqã€neã€ltã€gtã€andã€or ç­‰ç­‰ï¼‰å‡å®ç°ä¸ºå‡½æ•°ï¼›åœ¨ç®¡é“ä¸­ï¼Œè¿ç®—ç¬¦å¯ä»¥ç”¨æ‹¬å·<code>ï¼ˆï¼‰</code>è¿›è¡Œåˆ†å‰²ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥å»äº†è§£æ§åˆ¶æµç¨‹æ¡ä»¶è¯­å¥ã€å¾ªç¯å’Œä½œç”¨åŸŸä¿®é¥°ç¬¦çš„ä½¿ç”¨ã€‚</p>
<h2 id="4ã€æµç¨‹æ§åˆ¶"><a href="#4ã€æµç¨‹æ§åˆ¶" class="headerlink" title="4ã€æµç¨‹æ§åˆ¶"></a>4ã€æµç¨‹æ§åˆ¶</h2><p>æ§åˆ¶æµç¨‹ä¸ºæ¨¡æ¿ä½œè€…æä¾›äº†æ§åˆ¶æ¨¡æ¿ç”Ÿæˆæµç¨‹çš„åŠŸèƒ½ï¼ŒHelm çš„æ¨¡æ¿è¯­è¨€æä¾›äº†ä»¥ä¸‹ä¸€äº›æµç¨‹æ§åˆ¶ï¼š</p>
<ul>
<li><code>if/else</code> æ¡ä»¶è¯­å¥</li>
<li><code>with</code> æŒ‡å®šä¸€ä¸ªä½œç”¨åŸŸèŒƒå›´</li>
<li><code>range</code> æä¾›ç±»ä¼¼äº <code>for each</code> è¿™æ ·çš„å¾ªç¯æ ·å¼</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æä¾›äº†ä¸€äº›<strong>å£°æ˜å’Œä½¿ç”¨å‘½åæ¨¡æ¿</strong>çš„æ“ä½œï¼š</p>
<ul>
<li><code>define</code> åœ¨æ¨¡æ¿å†…éƒ¨å£°æ˜ä¸€ä¸ªæ–°çš„å‘½åæ¨¡æ¿</li>
<li><code>template</code> å¯¼å…¥ä¸€ä¸ªå‘½åæ¨¡æ¿</li>
<li><code>block</code> å£°æ˜äº†ä¸€ç§ç‰¹æ®Šçš„å¯å¡«å……æ¨¡æ¿åŒºåŸŸã€‚</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬å…ˆæ¥äº†è§£ <code>if</code>ã€<code>with</code>ã€<code>range</code> è¯­å¥çš„ä½¿ç”¨ï¼Œå…¶ä»–å°†åœ¨åé¢çš„<code>å‘½åæ¨¡æ¿</code>éƒ¨åˆ†ä»‹ç»ã€‚</p>
<h3 id="1-if-else"><a href="#1-if-else" class="headerlink" title="1.if/else"></a>1.if/else</h3><p>é¦–å…ˆæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸‹æœ‰æ¡ä»¶åœ°åœ¨æ¨¡æ¿ä¸­åŒ…å«ä¸€ä¸ªæ–‡æœ¬åŒºåŸŸï¼Œå°±æ˜¯ <code>if/else</code> ï¼Œè¿™ä¸ªæ¡ä»¶åˆ¤æ–­çš„åŸºæœ¬ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; <span class="string">if</span> <span class="string">PIPELINE</span> &#125;&#125; <span class="comment">#PIPLINEå¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼</span></span><br><span class="line">  <span class="comment"># Do something </span></span><br><span class="line">&#123;&#123; <span class="string">else</span> <span class="string">if</span> <span class="string">OTHER</span> <span class="string">PIPELINE</span> &#125;&#125;</span><br><span class="line">  <span class="comment"># Do something else</span></span><br><span class="line">&#123;&#123; <span class="string">else</span> &#125;&#125;</span><br><span class="line">  <span class="comment"># Default case</span></span><br><span class="line">&#123;&#123; <span class="string">end</span> &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#æ³¨æ„ï¼šifå’Œelseä¸€å®šæ˜¯æˆå¯¹å­˜åœ¨çš„ã€‚</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°<strong>æˆ‘ä»¬è¿™é‡Œåˆ¤æ–­çš„æ˜¯ç®¡é“è€Œä¸æ˜¯ä¸€ä¸ª values å€¼</strong>ï¼Œè¿™æ˜¯å› ä¸ºæ§åˆ¶ç»“æ„å¯ä»¥æ‰§è¡Œæ•´ä¸ªç®¡é“ï¼Œè€Œä¸ä»…ä»…æ˜¯åˆ¤æ–­å€¼ã€‚å¦‚æœå€¼ä¸ºä»¥ä¸‹çš„ä¸€äº›å†…å®¹ï¼Œåˆ™å°†ç®¡é“åˆ¤æ–­ä¸º falseï¼š</p>
<ul>
<li>å¸ƒå°” false</li>
<li>æ•°å­—é›¶</li>
<li>ä¸€ä¸ªç©ºå­—ç¬¦ä¸²</li>
<li>nilï¼ˆempty æˆ–è€… nullï¼‰</li>
<li>ä¸€ä¸ªç©ºé›†åˆï¼ˆmapã€sliceã€tupleã€dictã€arrayï¼‰</li>
</ul>
<p>åœ¨å…¶ä»–æ¡ä»¶ä¸‹ï¼Œæ¡ä»¶éƒ½ä¸ºçœŸã€‚</p>
<table><tr><td bgcolor=yellow>ğŸ’˜ ç¤ºä¾‹ï¼šif/elseæµ‹è¯•-2022.4.6(æµ‹è¯•æˆåŠŸ)</td></tr></table>

<p>1ï¸âƒ£ ç°åœ¨æˆ‘ä»¬åœ¨ä¸Šé¢çš„ç¤ºä¾‹æ¨¡æ¿ <code>ConfigMap.yaml</code> ä¸­æ·»åŠ ä¸€ä¸ªç®€å•çš„æ¡ä»¶ï¼Œå¦‚æœ drink è®¾ç½®ä¸º coffeeï¼Œæˆ‘ä»¬å°±æ·»åŠ å¦å¤–ä¸€ä¸ªè®¾ç½®ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">if</span> <span class="string">eq</span> <span class="string">.Values.favorite.drink</span> <span class="string">&quot;coffee&quot;</span> &#125;&#125;<span class="attr">mug:</span> <span class="literal">true</span>&#123;&#123; <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æŠŠ values.yaml æ–‡ä»¶å†…å®¹è®¾ç½®æˆä¸‹é¢çš„æ ·å­ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">favorite:</span></span><br><span class="line">  <span class="comment"># drink: coffee</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">pizza</span></span><br></pre></td></tr></table></figure>



<p>2ï¸âƒ£ ç”±äºæˆ‘ä»¬æ³¨é‡Šæ‰äº† <code>drink: coffee</code>ï¼Œæ‰€ä»¥æ¸²æŸ“åè¾“å‡ºä¸ä¼šåŒ…å« <code>mug: true</code> çš„æ ‡å¿—ã€‚</p>
<p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸‹ï¼š:warning: (ç”¨äºæ¯”è¾ƒçš„ä¸å…¼å®¹ç±»å‹)</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220406185156744.png" alt="image-20220406185156744"></p>
<p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬æŠŠæ³¨é‡Šå–æ¶ˆæ‰ï¼Œåˆ™åº”è¯¥è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºçš„å†…å®¹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#values.yaml</span></span><br><span class="line"><span class="attr">favorite:</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">coffee</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">pizza</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="string">âœ</span>  <span class="string">helm</span> <span class="string">install</span> <span class="string">--generate-name</span> <span class="string">--dry-run</span> <span class="string">./mychart</span></span><br><span class="line"><span class="string">â€¦â€¦</span></span><br><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1649242370-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;PIZZA&quot;</span></span><br><span class="line">  <span class="attr">mug:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å› ä¸ºä¸Šé¢æ¨¡æ¿ä¸­æˆ‘ä»¬æ·»åŠ äº† <code>if eq .Values.favorite.drink &quot;coffee&quot;</code> è¿™æ ·çš„æ¡ä»¶åˆ¤æ–­ï¼Œç›¸å½“äºæ˜¯åˆ¤æ–­ <code>.Values.favorite.drink</code> å€¼æ˜¯å¦ç­‰äº <code>&quot;coffee&quot;</code>ï¼Œå¦‚æœç›¸ç­‰åˆ™æ¸²æŸ“ <code>mug: true</code>ã€‚</p>
<p>3ï¸âƒ£ è¿™é‡Œæˆ‘ä»¬å†å¾ˆå…³æ³¨ä¸€ä¸‹ç»†èŠ‚é—®é¢˜</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#values.yaml</span></span><br><span class="line"><span class="attr">favorite:</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">coffee</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">pizza</span></span><br></pre></td></tr></table></figure>

<p>æ€è€ƒï¼šè¿™ä¸ªæ¨¡æ¿é‡Œ<code>ifæµç¨‹æ§åˆ¶è¯­å¥</code>ä¸ºä»€ä¹ˆä¸å¯ä»¥ç«–ç€å†™ï¼Œè€Œè¦å†™åœ¨ä¸€è¡Œä¸Šï¼Ÿä¸ä¼šä¸æ„Ÿè§‰å¯è¯»æ€§ä¸å¥½ï¼</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220406185607717.png" alt="image-20220406185607717"></p>
<p>æˆ‘ä»¬è¿™é‡Œå°è¯•è¿™ç«–ç€å†™çœ‹ä¸‹æœ‰ä»€ä¹ˆæ•ˆæœï¼š</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220406185801088.png" alt="image-20220406185801088"></p>
<p>ç«–ç€å†™ï¼Œå½“æ¨¡æ¿è¢«æ¸²æŸ“ä¹‹åï¼Œè¿™é‡Œä¼šå¤šå‡º2ä¸ªç©ºè¡Œï¼</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šè¿™é‡Œæ·»åŠ 2ä¸ª<code>-</code>å³å¯ã€‚</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220406190058348.png" alt="image-20220406190058348"></p>
<p>4ï¸âƒ£ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†ä½¿ç”¨ä¸‹<code>ifâ€¦â€¦ esle if â€¦â€¦else</code>ï¼Œçœ‹ä¸‹æ•ˆæœ</p>
<p>é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#values.yaml</span></span><br><span class="line"><span class="attr">favorite:</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">coffee</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">pizza</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">if</span> <span class="string">eq</span> <span class="string">.Values.favorite.drink</span> <span class="string">&quot;coffee&quot;</span> <span class="string">-</span>&#125;&#125;</span><br><span class="line">  <span class="attr">condiition:</span> <span class="literal">true</span></span><br><span class="line">  &#123;&#123; <span class="string">else</span> <span class="string">if</span> <span class="string">eq</span> <span class="string">.Values.favorite.drink</span> <span class="string">&quot;water&quot;</span> <span class="string">-</span>&#125;&#125;</span><br><span class="line">  <span class="attr">elsecondition:</span> <span class="literal">true</span></span><br><span class="line">  &#123;&#123; <span class="string">else</span> <span class="string">-</span>&#125;&#125;</span><br><span class="line">  <span class="attr">defaultcase:</span> <span class="literal">true</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;  </span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¸²æŸ“ä¸‹ï¼ŒæŸ¥çœ‹æ•ˆæœï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">âœ</span>  <span class="string">local-vscode</span> <span class="string">helm</span> <span class="string">install</span> <span class="string">--generate-name</span> <span class="string">--dry-run</span> <span class="string">--set</span> <span class="string">favorite.drink=water</span> <span class="string">./mychart</span></span><br><span class="line"><span class="string">â€¦â€¦</span></span><br><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1649243095-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;water&quot;</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;PIZZA&quot;</span></span><br><span class="line">  <span class="attr">elsecondition:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="string">âœ</span>  <span class="string">local-vscode</span> <span class="string">helm</span> <span class="string">install</span> <span class="string">--generate-name</span> <span class="string">--dry-run</span> <span class="string">--set</span> <span class="string">favorite.drink=waterxxx</span> <span class="string">./mychart</span></span><br><span class="line"><span class="string">â€¦â€¦</span></span><br><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1649243172-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;waterxxx&quot;</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;PIZZA&quot;</span></span><br><span class="line">  <span class="attr">defaultcase:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ç»“æŸã€‚ğŸ˜˜</p>
<h3 id="2-ç©ºæ ¼æ§åˆ¶"><a href="#2-ç©ºæ ¼æ§åˆ¶" class="headerlink" title="2.ç©ºæ ¼æ§åˆ¶"></a>2.ç©ºæ ¼æ§åˆ¶</h3><p>è¿˜æœ‰ä¸€ä¸ªéå¸¸é‡è¦çš„åŠŸèƒ½ç‚¹å°±æ˜¯å…³äºç©ºæ ¼çš„æ§åˆ¶ï¼Œå› ä¸ºç©ºæ ¼å¯¹äº YAML æ–‡ä»¶éå¸¸é‡è¦çš„ï¼Œä¸æ˜¯è¯´ä»»æ„ç¼©è¿›å°±å¯ä»¥ã€‚</p>
<table><tr><td bgcolor=yellow>ğŸ’˜ ç¤ºä¾‹ï¼šç©ºæ ¼æ§åˆ¶æµ‹è¯•-2022.4.7(æµ‹è¯•æˆåŠŸ)</td></tr></table>

<p>:warning: å…³äºç©ºæ ¼æ§åˆ¶ï¼Œå…¶å®ä¸Šé¢é‚£ä¸ªç¤ºä¾‹æœ‰æµ‹è¯•è¿‡äº†ï¼Œè¿™é‡Œæˆ‘ä»¬å†æ¬¡åšä¸‹å®éªŒã€‚</p>
<p>1ï¸âƒ£ ä¾ç„¶è¿˜æ˜¯ä»¥å‰é¢çš„ä¾‹å­ä¸ºä¾‹ï¼Œæˆ‘ä»¬æ¥æ ¼å¼åŒ–ä¸‹æ¨¡æ¿æ ¼å¼ä»¥æ›´æ˜“äºé˜…è¯»ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">if</span> <span class="string">eq</span> <span class="string">.Values.favorite.drink</span> <span class="string">&quot;coffee&quot;</span> &#125;&#125;</span><br><span class="line">    <span class="attr">mug:</span> <span class="literal">true</span></span><br><span class="line">  &#123;&#123; <span class="string">end</span> &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#values.yaml</span></span><br><span class="line"><span class="attr">favorite:</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">coffee</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">pizza</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬çš„æ¨¡æ¿çœ‹ä¸Šå»æ›´æ˜“äºé˜…è¯»äº†ï¼Œä½†æ˜¯æˆ‘ä»¬é€šè¿‡æ¨¡æ¿å¼•æ“æ¥æ¸²æŸ“ä¸‹ï¼Œå´ä¼šå¾—åˆ°å¦‚ä¸‹çš„é”™è¯¯ä¿¡æ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">âœ  helm install --generate-name --dry-run ./mychart</span><br><span class="line">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/hg/.kube/config</span><br><span class="line">WARNING: Kubernetes configuration file is world-readable. This is insecure. Location: /home/hg/.kube/config</span><br><span class="line">Error: INSTALLATION FAILED: YAML parse error on mychart/templates/ConfigMap.yaml: error converting YAML to JSON: yaml: line 9: did not find expected key</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨æ¨¡æ¿ä¸­æ·»åŠ äº†ç©ºæ ¼ï¼Œç”Ÿæˆäº†ä¸æ­£ç¡®çš„ YAML æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1575970308-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;PIZZA&quot;</span></span><br><span class="line">    <span class="attr">mug:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>mug: true</code> çš„ç¼©è¿›æ˜¯æœ‰é—®é¢˜çš„ï¼Œä¸ç¬¦åˆ YAML æ–‡ä»¶æ ¼å¼ï¼Œç°åœ¨æˆ‘ä»¬å°†ç¼©è¿›å»æ‰è¯•çœ‹çœ‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">if</span> <span class="string">eq</span> <span class="string">.Values.favorite.drink</span> <span class="string">&quot;coffee&quot;</span> &#125;&#125;</span><br><span class="line">  <span class="attr">mug:</span> <span class="literal">true</span></span><br><span class="line">  &#123;&#123; <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>é‡æ–°æ¸²æŸ“æ¨¡æ¿ï¼Œç„¶åå¯ä»¥å‘ç°å·²ç»å¯ä»¥æ­£å¸¸é€šè¿‡äº†ï¼Œä½†æ˜¯æ¸²æŸ“å‡ºæ¥çš„ YAML æ–‡ä»¶æ ¼å¼çœ‹ä¸Šå»è¿˜æ˜¯æœ‰ç‚¹å¥‡æ€ªï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Source: mychart/templates/configmap.yaml</span></span><br><span class="line"><span class="string">âœ</span>  <span class="string">helm</span> <span class="string">install</span> <span class="string">--generate-name</span> <span class="string">--dry-run</span> <span class="string">./mychart</span></span><br><span class="line"><span class="attr">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location:</span> <span class="string">/home/hg/.kube/config</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1649321939-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;PIZZA&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">mug:</span> <span class="literal">true</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¾—åˆ°çš„ YAML æ–‡ä»¶ä¸­å¤šäº†ä¸€äº›ç©ºè¡Œï¼Œè¿™æ˜¯å› ä¸ºæ¨¡æ¿å¼•æ“æ¸²æŸ“çš„æ—¶å€™å®ƒä¼šåˆ é™¤ <code>&#123;&#123;` å’Œ `&#125;&#125;</code> ä¹‹é—´çš„å†…å®¹ï¼Œ<strong>ä½†æ˜¯ä¼šå®Œå…¨ä¿ç•™å…¶ä½™çš„ç©ºæ ¼</strong>ã€‚æˆ‘ä»¬çŸ¥é“åœ¨ YAML æ–‡ä»¶ä¸­ç©ºæ ¼æ˜¯æœ‰æ„ä¹‰çš„ï¼Œæ‰€ä»¥ç®¡ç†ç©ºæ ¼å°±å˜å¾—éå¸¸é‡è¦äº†ï¼Œä¸è¿‡ <strong>Helm æ¨¡æ¿ä¹Ÿæä¾›äº†ä¸€äº›å·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬ç®¡ç†ç©ºæ ¼</strong>ã€‚</p>
<p>é¦–å…ˆå¯ä»¥ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ä¿®æ”¹æ¨¡æ¿å£°æ˜çš„èŠ±æ‹¬å·è¯­æ³•ï¼Œä»¥å‘Šè¯‰æ¨¡æ¿å¼•æ“å»æ‰ç©ºæ ¼ã€‚<code>&#123;&#123;-` æ·»åŠ äº†ç ´æŠ˜å·å’Œç©ºæ ¼è¡¨ç¤ºåº”å°†å·¦è¾¹çš„ç©ºæ ¼ç§»é™¤ï¼Œ`-&#125;&#125;</code>è¡¨ç¤ºå°†å³è¾¹çš„ç©ºæ ¼ç§»é™¤ï¼Œ<code>å¦å¤–ä¹Ÿéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¢è¡Œç¬¦ä¹Ÿæ˜¯ç©ºæ ¼</code>ã€‚</p>
<p>ç©ºæ ¼</p>
<p>éœ€è¦æ³¨æ„çš„æ—¶å€™è¦ç¡®ä¿ <code>-</code> å’ŒæŒ‡ä»¤çš„å…¶ä½™éƒ¨åˆ†ä¹‹é—´è¦æœ‰ç©ºæ ¼ï¼Œ<code>&#123;&#123;- 3 &#125;&#125;</code> è¡¨ç¤ºåˆ é™¤å·¦è¾¹çš„ç©ºæ ¼å¹¶æ‰“å°3ï¼Œä½†æ˜¯ <code>&#123;&#123;-3 &#125;&#125;</code>è¡¨ç¤ºæ‰“å°<code>-3</code>ã€‚</p>
<p>2ï¸âƒ£ ä½¿ç”¨è¿™ä¸ªè¯­æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸Šé¢çš„æ¨¡æ¿æ¥ç§»é™¤å¤šä½™çš„ç©ºè¡Œï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">if</span> <span class="string">eq</span> <span class="string">.Values.favorite.drink</span> <span class="string">&quot;coffee&quot;</span> &#125;&#125;</span><br><span class="line">  <span class="attr">mug:</span> <span class="literal">true</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æ¸²æŸ“åå¯ä»¥çœ‹åˆ°ç©ºè¡Œè¢«ç§»é™¤æ‰äº†ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">âœ</span>  <span class="string">helm</span> <span class="string">install</span> <span class="string">--generate-name</span> <span class="string">--dry-run</span> <span class="string">./mychart</span></span><br><span class="line"><span class="comment"># Source: mychart/templates/configmap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1575972373-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;PIZZA&quot;</span></span><br><span class="line">  <span class="attr">mug:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>



<p>3ï¸âƒ£ ä¸ºäº†æ›´åŠ æ¸…æ¥šåœ°è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ç”¨<code>*</code>æ¥ä»£æ›¿å°†è¦åˆ é™¤çš„æ¯ä¸ªç©ºæ ¼ï¼Œè¡Œå°¾çš„<code>*</code>è¡¨ç¤ºè¢«åˆ é™¤çš„æ¢è¡Œç¬¦ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;<span class="string">*</span></span><br><span class="line"><span class="string">**&#123;&#123;-</span> <span class="string">if</span> <span class="string">eq</span> <span class="string">.Values.favorite.drink</span> <span class="string">&quot;coffee&quot;</span> <span class="string">&#125;&#125;</span></span><br><span class="line">  <span class="attr">mug:</span> <span class="literal">true</span><span class="string">*</span></span><br><span class="line"><span class="string">**&#123;&#123;-</span> <span class="string">end</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>:warning: æ‰€ä»¥æˆ‘ä»¬è¿™é‡Œç”¨ <code>&#123;&#123;-` è¡¨ç¤ºçš„å°±æ˜¯åˆ é™¤æœ¬è¡Œå¼€å¤´çš„ä¸¤ä¸ªç©ºæ ¼ä»¥åŠä¸Šä¸€è¡Œçš„æ¢è¡Œç¬¦ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯å°±å°†ç©ºè¡Œéƒ½åˆ é™¤äº†å•Šã€‚



4ï¸âƒ£ åœ¨ä½¿ç”¨ç§»é™¤ç©ºæ ¼çš„æ—¶å€™è¿˜éœ€è¦å°å¿ƒï¼Œæ¯”å¦‚ä¸‹é¢çš„æ“ä½œï¼š

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">if</span> <span class="string">eq</span> <span class="string">.Values.favorite.drink</span> <span class="string">&quot;coffee&quot;</span> <span class="string">-</span>&#125;&#125;</span><br><span class="line"><span class="attr">mug:</span> <span class="literal">true</span></span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">end</span> <span class="string">-</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

æˆ‘ä»¬ä¾ç„¶è¿˜æ˜¯å¯ä»¥ç”¨ `*` æ¥ä»£æ›¿ç©ºæ ¼è¿›è¡Œåˆ†æï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;<span class="string">*</span></span><br><span class="line"><span class="string">**&#123;&#123;-</span> <span class="string">if</span> <span class="string">eq</span> <span class="string">.Values.favorite.drink</span> <span class="string">&quot;coffee&quot;</span> <span class="string">-&#125;&#125;*</span></span><br><span class="line">  <span class="attr">mug:</span> <span class="literal">true</span><span class="string">*</span></span><br><span class="line"><span class="string">**&#123;&#123;-</span> <span class="string">end</span> <span class="string">-&#125;&#125;</span></span><br></pre></td></tr></table></figure>

ç¬¬ä¸€ä¸ª `&#123;&#123;-` ä¼šåˆ é™¤å‰é¢çš„ç©ºæ ¼å’Œå‰é¢çš„æ¢è¡Œç¬¦ï¼Œç„¶ååé¢çš„ `-&#125;&#125;</code> ä¼šåˆ é™¤å½“å‰è¡Œçš„æ¢è¡Œç¬¦ï¼Œè¿™æ ·å°±ä¼šæŠŠ <code>mug: true</code> ç§»åŠ¨åˆ° <code>food: &quot;PIZZA&quot;</code> åé¢å»äº†ï¼Œæœ€ç»ˆæ¸²æŸ“è¿‡åå°±ä¼šå˜æˆï¼š<code>food: &quot;PIZZA&quot;mug: true</code>ï¼Œå› ä¸ºåœ¨ä¸¤ä¾§éƒ½å»æ‰æ¢è¡Œç¬¦ã€‚</p>
<blockquote>
<p>æœ‰å…³æ¨¡æ¿ä¸­ç©ºæ ¼æ§åˆ¶çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¯ä»¥æŸ¥çœ‹ <a target="_blank" rel="noopener" href="https://godoc.org/text/template">Go æ¨¡æ¿å®˜æ–¹æ–‡æ¡£</a>ä»‹ç»ã€‚</p>
</blockquote>
<p>5ï¸âƒ£ ç¼©è¿›å‡½æ•°ï¼ˆ<code>&#123;&#123; indent 2 "mug: true" &#125;&#125;</code>ï¼‰ä½¿ç”¨</p>
<p>:warning: ä¸è¿‡æœ‰æ—¶å€™å‘Šè¯‰æ¨¡æ¿ç³»ç»Ÿå¦‚ä½•ç¼©è¿›æ¯”èµ·å»æ§åˆ¶æ¨¡æ¿æŒ‡ä»¤çš„é—´è·æ›´åŠ å®¹æ˜“ï¼Œæ‰€ä»¥ï¼Œæœ‰æ—¶å€™ä½ ä¼šå‘ç°ç¼©è¿›å‡½æ•°ï¼ˆ<code>&#123;&#123; indent 2 "mug: true" &#125;&#125;</code>ï¼‰æ›´æœ‰ç”¨ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.Values.favorite.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.Values.favorite.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">indent</span> <span class="number">2</span> <span class="string">&quot;indent: 2&quot;</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">if</span> <span class="string">eq</span> <span class="string">.Values.favorite.drink</span> <span class="string">&quot;coffee&quot;</span> &#125;&#125;</span><br><span class="line">  <span class="attr">mug:</span> <span class="literal">true</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">#values.yaml</span></span><br><span class="line"><span class="attr">favorite:</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">coffee</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">pizza</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ¸²æŸ“ä¸‹ï¼Œç»“æœæ˜¯æŠ¥é”™çš„ï¼š</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220407170527766.png" alt="image-20220407170527766"></p>
<p>å› ä¸º<code>&#123;&#123; indent 2 "indent: 2" &#125;&#125;</code>è¿™ä¸ªéœ€è¦é¡¶æ ¼å†™ï¼š</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220407170954402.png" alt="image-20220407170954402"></p>
<p>æµ‹è¯•ç»“æŸã€‚ğŸ˜˜</p>
<h3 id="3-ä½¿ç”¨-with-ä¿®æ”¹ä½œç”¨åŸŸ"><a href="#3-ä½¿ç”¨-with-ä¿®æ”¹ä½œç”¨åŸŸ" class="headerlink" title="3.ä½¿ç”¨ with ä¿®æ”¹ä½œç”¨åŸŸ"></a>3.ä½¿ç”¨ with ä¿®æ”¹ä½œç”¨åŸŸ</h3><p>æ¥ä¸‹æ¥éœ€è¦äº†è§£çš„æ˜¯ <code>with</code> æ“ä½œï¼Œå®ƒå¯ä»¥æ§åˆ¶å˜é‡çš„ä½œç”¨åŸŸï¼Œç„¶åé‡æ–°ç”¨ <code>.</code> è°ƒç”¨å°±è¡¨ç¤ºå¯¹å½“å‰ä½œç”¨åŸŸçš„å¼•ç”¨ã€‚æ‰€ä»¥ï¼Œ<u><code>.Values</code> æ˜¯å‘Šè¯‰æ¨¡æ¿å¼•æ“åœ¨å½“å‰ä½œç”¨åŸŸä¸‹å†…æŸ¥æ‰¾ Values å¯¹è±¡ã€‚</u></p>
<p><code>with</code> è¯­å¥çš„è¯­æ³•å’Œ <code>if</code> è¯­å¥æ¯”è¾ƒç±»ä¼¼ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; <span class="string">with</span> <span class="string">PIPELINE</span> &#125;&#125;</span><br><span class="line">  <span class="comment"># é™åˆ¶èŒƒå›´</span></span><br><span class="line">&#123;&#123; <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>



<table><tr><td bgcolor=yellow>ğŸ’˜ ç¤ºä¾‹ï¼šä½¿ç”¨withä¿®æ”¹ä½œç”¨åŸŸ-2022.4.7(æµ‹è¯•æˆåŠŸ)</td></tr></table>

<p>1ï¸âƒ£ èŒƒå›´å¯ä»¥æ›´æ”¹ï¼Œå¯ä»¥è®©ä½ å°†å½“å‰èŒƒå›´ <code>.</code> è®¾ç½®ä¸ºç‰¹å®šçš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨ä½¿ç”¨ <code>.Values.favorites</code>ï¼Œè®©æˆ‘ä»¬é‡å†™ä¸‹æ¨¡æ¿æ–‡ä»¶ ConfigMap æ¥æ›´æ”¹ <code>.</code> çš„èŒƒå›´æŒ‡å‘ <code>.Values.favorites</code>ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">with</span> <span class="string">.Values.favorite</span> &#125;&#125;</span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">#values.yaml</span></span><br><span class="line"><span class="attr">favorite:</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">coffee</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">pizza</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿™é‡Œå°†å‰é¢ç»ƒä¹ çš„ <code>if</code> æ¡ä»¶è¯­å¥åˆ é™¤äº†ï¼Œåœ¨æ¨¡æ¿ä¸­æˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ª <code>&#123;&#123;- with .Values.favorite &#125;&#125;</code> çš„è¯­å¥ï¼Œæ„æ€å°±æ˜¯è¯´åœ¨ <code>with</code> è¯­å¥çš„ä½œç”¨èŒƒå›´å†…å¯ä»¥ç”¨ <code>.</code> è¡¨ç¤º <code>.Values.favorite</code> äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¼•ç”¨ <code>.drink</code> å’Œ <code>.food</code> äº†ï¼Œä½†æ˜¯åœ¨ <code>&#123;&#123; end &#125;&#125;</code> ä¹‹åå°±ä¼šé‡ç½®ä¸ºä¹‹å‰çš„ä½œç”¨åŸŸäº†ã€‚</p>
<p>æ¸²æŸ“ç»“æœï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">âœ</span>  <span class="string">helm</span> <span class="string">install</span> <span class="string">--generate-name</span> <span class="string">--dry-run</span> <span class="string">./mychart</span></span><br><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1649331891-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;PIZZA&quot;</span></span><br></pre></td></tr></table></figure>



<p>2ï¸âƒ£ ä¸è¿‡éœ€è¦æ³¨æ„å¾—æ˜¯ï¼Œ**<u>åœ¨å—é™çš„ä½œç”¨åŸŸèŒƒå›´å†…ï¼Œä½ æ— æ³•ä»çˆ¶çº§èŒƒå›´è®¿é—®åˆ°å…¶ä»–å¯¹è±¡</u>**ï¼Œæ¯”å¦‚ï¼Œä¸‹é¢å¾—æ¨¡æ¿ä¼šå¤±è´¥ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">with</span> <span class="string">.Values.favorite</span> &#125;&#125;</span><br><span class="line"><span class="attr">drink:</span> &#123;&#123; <span class="string">.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line"><span class="attr">food:</span> &#123;&#123; <span class="string">.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line"><span class="attr">release:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;</span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220407195648061.png" alt="image-20220407195648061"></p>
<p>å› ä¸º <code>Release.Name</code> å¹¶ä¸åœ¨ <code>.</code> çš„é™åˆ¶èŒƒå›´å†…ï¼Œæ‰€ä»¥ä¼šäº§ç”Ÿé”™è¯¯ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬äº¤æ¢æœ€åä¸¤è¡Œï¼Œåˆ™å°±å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼Œå› ä¸º <code>&#123;&#123; end &#125;&#125;</code> ä¹‹åä¼šé‡ç½®ä½œç”¨åŸŸã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">with</span> <span class="string">.Values.favorite</span> &#125;&#125;</span><br><span class="line"><span class="attr">drink:</span> &#123;&#123; <span class="string">.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line"><span class="attr">food:</span> &#123;&#123; <span class="string">.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br><span class="line"><span class="attr">release:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220407195730184.png" alt="image-20220407195730184"></p>
<p>æµ‹è¯•ç»“æŸã€‚ğŸ˜˜</p>
<p>ä¸‹é¢æˆ‘å…ˆæ¥äº†è§£ä¸‹ <code>range</code>ï¼Œç„¶åæˆ‘ä»¬å†å»äº†è§£ä¸‹æ¨¡æ¿å˜é‡ï¼Œå®ƒå¯ä»¥ä¸ºä¸Šé¢å¾—è¿™ä¸ªèŒƒå›´é—®é¢˜æä¾›ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚</p>
<h3 id="4-range-å¾ªç¯æ“ä½œ"><a href="#4-range-å¾ªç¯æ“ä½œ" class="headerlink" title="4.range å¾ªç¯æ“ä½œ"></a>4.range å¾ªç¯æ“ä½œ</h3><p>æˆ‘ä»¬çŸ¥é“è®¸å¤šç¼–ç¨‹è¯­è¨€éƒ½æ”¯æŒä½¿ç”¨ <code>for</code> å¾ªç¯ã€<code>foreach</code> å¾ªç¯æˆ–è€…ç±»ä¼¼åŠŸèƒ½æœºåˆ¶è¿›è¡Œå¾ªç¯è¿­ä»£ã€‚åœ¨ Helm å¾—æ¨¡æ¿è¯­è¨€ä¸­ï¼Œè¿­ä»£é›†åˆå¾—æ–¹æ³•æ˜¯ä½¿ç”¨ <code>range</code> è¿ç®—ç¬¦ã€‚</p>
<table><tr><td bgcolor=yellow>ğŸ’˜ ç¤ºä¾‹ï¼šrangeå¾ªç¯æ“ä½œ-2022.4.7(æµ‹è¯•æˆåŠŸ)</td></tr></table>

<p>1ï¸âƒ£ æ¯”å¦‚é¦–å…ˆæˆ‘ä»¬åœ¨ <code>values.yaml</code> æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä»½ pizza é¦…æ–™åˆ—è¡¨ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">favorite:</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">coffee</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">pizza</span></span><br><span class="line"><span class="attr">pizzaToppings:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">mushrooms</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cheese</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">peppers</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">onions</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬æœ‰äº† <code>pizzaToppings</code> åˆ—è¡¨ï¼ˆåœ¨æ¨¡æ¿ä¸­ç§°ä¸ºåˆ‡ç‰‡ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æ¥ä¿®æ”¹ä¸‹æ¨¡æ¿å°†åˆ—è¡¨æ‰“å°åˆ° ConfigMap ä¸­ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">with</span> <span class="string">.Values.favorite</span> &#125;&#125;</span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br><span class="line">  <span class="attr">toppings:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    &#123;&#123;- range .Values.pizzaToppings &#125;&#125;</span></span><br><span class="line"><span class="string">    - &#123;&#123; . | title | quote &#125;&#125;</span></span><br><span class="line"><span class="string">    &#123;&#123;- end &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä»”ç»†è§‚å¯Ÿä¸‹æ¨¡æ¿ä¸­çš„ <code>toppings:</code> åˆ—è¡¨ï¼Œ<code>range</code> å‡½æ•°å°†éå† <code>Values.pizzaToppings</code> åˆ—è¡¨ï¼Œæˆ‘ä»¬çœ‹åˆ°é‡Œé¢ä½¿ç”¨äº†ä¸€ä¸ª <code>.</code>ï¼Œç±»ä¼¼äºä¸Šé¢æˆ‘ä»¬ç”¨ <code>with</code> è®¾ç½®èŒƒå›´ä¸€æ ·ï¼Œè¿ç®—ç¬¦ä¹Ÿæ˜¯è¿™æ ·çš„ï¼Œæ¯æ¬¡å¾ªç¯ï¼Œ<code>.</code> éƒ½ä¼šè¢«è®¾ç½®ä¸ºå½“å‰çš„ <code>pizzaTopping</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ç¬¬ä¸€æ¬¡è®¾ç½®ä¸º<code>mushrooms</code>ï¼Œç¬¬äºŒæ¬¡è¿­ä»£è®¾ç½®ä¸º<code>cheese</code>ï¼Œä¾æ¬¡ç±»æ¨ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¼ é€’ <code>.</code> è¿™ä¸ªå€¼åˆ°ç®¡é“ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œ <code>&#123;&#123; . | title | quote &#125;&#125;</code> å°±ç›¸å½“äºå‘é€ <code>.</code> ç»™ <code>title</code>ï¼ˆæ ‡é¢˜å¤§å°å†™å‡½æ•°ï¼‰å‡½æ•°ï¼Œç„¶åå‘é€ç»™ <code>quote</code> å‡½æ•°ã€‚</p>
<p>2ï¸âƒ£ æˆ‘ä»¬æ¸²æŸ“è¿™ä¸ªæ¨¡æ¿ï¼Œä¼šè¾“å‡ºå¦‚ä¸‹çš„å†…å®¹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Source: mychart/templates/configmap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1575975849-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;PIZZA&quot;</span></span><br><span class="line">  <span class="attr">toppings:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    - &quot;Mushrooms&quot;</span></span><br><span class="line"><span class="string">    - &quot;Cheese&quot;</span></span><br><span class="line"><span class="string">    - &quot;Peppers&quot;</span></span><br><span class="line"><span class="string">    - &quot;Onions&quot;</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢æ¨¡æ¿ä¸­ï¼Œæˆ‘ä»¬åšäº†ä¸€äº›å°å°çš„ç‰¹æ®Šå¤„ç†ï¼Œ<code>toppings: |-</code> è¡Œè¡¨ç¤ºå£°æ˜ä¸€ä¸ªå¤šè¡Œå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å…¶å®æˆ‘ä»¬çš„ <code>toppings</code> åˆ—è¡¨ä¸æ˜¯ä¸€ä¸ª YAML åˆ—è¡¨ï¼Œè€Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„å­—ç¬¦ä¸²ï¼Œè¿™æ˜¯å› ä¸º ConfigMap ä¸­çš„æ•°æ®ç”± <code>key/value</code> å¯¹ç»„æˆï¼Œæ‰€æœ‰ key å’Œ value éƒ½æ˜¯ç®€å•çš„å­—ç¬¦ä¸²ï¼Œè¦äº†è§£ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·çš„ï¼Œå¯ä»¥æŸ¥çœ‹ <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/user-guide/configmap/">Kubernetes ConfigMap æ–‡æ¡£</a>ï¼Œä¸è¿‡è¿™ä¸ªç»†èŠ‚å¯¹æˆ‘ä»¬è¿™é‡Œä¸é‡è¦ã€‚</p>
<p>:warning: éœ€è¦æ³¨æ„ä¸‹ï¼šè¿™é‡Œå¦‚æœä¸è·Ÿä¸Š<code>|</code>çš„è¯ï¼Œä¼šæŠ¥é”™çš„ï¼(å±äº yamléƒ¨åˆ†å†…å®¹)</p>
<p>è¿™é‡ŒåŠ ä¸åŠ <code>-</code>å·éƒ½æ˜¯å¯ä»¥æ¸²æŸ“æˆåŠŸçš„ã€‚</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220407202106197.png" alt="image-20220407202106197"></p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220407202201169.png" alt="image-20220407202201169"></p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220407202226179.png" alt="image-20220407202226179"></p>
<p>3ï¸âƒ£ YAMLéƒ¨åˆ†å†…å®¹</p>
<p>(1)å¤šè¡Œå­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨ <code>|</code> ä¿ç•™æ¢è¡Œç¬¦ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>&gt;</code> æŠ˜å æ¢è¡Œï¼Œå¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">this: |</span><br><span class="line"> Foo</span><br><span class="line"> Bar</span><br><span class="line">that: &gt;</span><br><span class="line"> Foo</span><br><span class="line"> Bar</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„æ„æ€å°±æ˜¯ï¼š<code>&#123;this: &#39;Foo\nBar\n&#39;, that: &#39;Foo Bar\n&#39;&#125;</code></p>
<p>(2)<code>+</code> è¡¨ç¤ºä¿ç•™æ–‡å­—å—æœ«å°¾çš„æ¢è¡Œï¼Œ<code>-</code> è¡¨ç¤ºåˆ é™¤å­—ç¬¦ä¸²æœ«å°¾çš„æ¢è¡Œï¼Œå¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s1: |</span><br><span class="line">Foo</span><br><span class="line"></span><br><span class="line">s2: |+</span><br><span class="line">Foo</span><br><span class="line"></span><br><span class="line">s3: |-</span><br><span class="line">Foo</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„æ„æ€å°±æ˜¯ï¼š<code>&#123;s1: &#39;Foo\n&#39;, s2: &#39;Foo\n\n\n&#39;, s3: &#39;Foo&#39;&#125;</code></p>
<p>4ï¸âƒ£ æœ‰æ—¶å€™ï¼Œåœ¨æ¨¡æ¿ä¸­å¿«é€Ÿåˆ›å»ºä¸€ä¸ªåˆ—è¡¨ï¼Œç„¶åéå†è¯¥åˆ—è¡¨å¾ˆæœ‰ç”¨ï¼ŒHelm æ¨¡æ¿å…·æœ‰ç®€åŒ–è¯¥åŠŸèƒ½çš„å‡½æ•°ï¼š<code>tuple</code>ã€‚å…ƒç»„æ˜¯å›ºå®šå¤§å°çš„åˆ—è¡¨é›†åˆï¼Œä½†æ˜¯å…·æœ‰ä»»æ„æ•°æ®ç±»å‹ï¼Œä¸‹é¢æ˜¯å…ƒç»„çš„å¤§æ¦‚ä½¿ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sizes:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">  &#123;&#123;- range tuple &quot;small&quot; &quot;medium&quot; &quot;large&quot; &#125;&#125;</span></span><br><span class="line"><span class="string">  - &#123;&#123; . &#125;&#125;</span></span><br><span class="line"><span class="string">  &#123;&#123;- end &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„æ¨¡æ¿æœ€ç»ˆä¼šè¢«æ¸²æŸ“æˆå¦‚ä¸‹çš„ YAMLï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sizes: |-</span><br><span class="line">  - small</span><br><span class="line">  - medium</span><br><span class="line">  - large</span><br></pre></td></tr></table></figure>

<p>é™¤äº†åˆ—è¡¨å’Œå…ƒç»„ä¹‹å¤–ï¼Œ<code>range</code> è¿˜å¯ä»¥ç”¨äºéå†å­—å…¸ï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚ä»‹ç»æ¨¡æ¿å˜é‡çš„æ—¶å€™å†æ¥äº†è§£è¿™ä¸ªç”¨æ³•å§ã€‚</p>
<h2 id="5ã€å˜é‡"><a href="#5ã€å˜é‡" class="headerlink" title="5ã€å˜é‡"></a>5ã€å˜é‡</h2><p>æœ‰äº†å‡½æ•°ã€ç®¡é“ã€å¯¹è±¡ä»¥åŠæ§åˆ¶ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³è±¡ä¸‹å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸­æ›´åŸºæœ¬çš„æ€æƒ³ä¹‹ä¸€ï¼š<code>å˜é‡</code>ã€‚åœ¨æ¨¡æ¿ä¸­ï¼Œå˜é‡çš„ä½¿ç”¨é¢‘ç‡è¾ƒä½ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥ä½¿ç”¨ä»–ä»¬æ¥ç®€åŒ–ä»£ç ï¼Œä»¥åŠæ›´å¥½åœ°ä½¿ç”¨ <code>with</code> å’Œ <code>range</code>ã€‚</p>
<table><tr><td bgcolor=yellow>ğŸ’˜ ç¤ºä¾‹ï¼šå˜é‡æµ‹è¯•-2022.4.7(æµ‹è¯•æˆåŠŸ)</td></tr></table>

<p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ä¸‹é¢çš„æ¨¡æ¿æ¸²æŸ“ä¼šå‡ºé”™ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">with</span> <span class="string">.Values.favorite</span> &#125;&#125;</span><br><span class="line"><span class="attr">drink:</span> &#123;&#123; <span class="string">.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line"><span class="attr">food:</span> &#123;&#123; <span class="string">.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line"><span class="attr">release:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;</span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸º <code>Release.Name</code> ä¸åœ¨ <code>with</code> è¯­å¥å—é™åˆ¶çš„èŒƒå›´ä¹‹å†…ï¼Œ<strong>è§£å†³ä½œç”¨åŸŸé—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯å°†å¯¹è±¡åˆ†é…ç»™åœ¨ä¸è€ƒè™‘å½“å‰ä½œç”¨åŸŸæƒ…å†µä¸‹è®¿é—®çš„å˜é‡</strong>ã€‚</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220408084600276.png" alt="image-20220408084600276"></p>
<p>1ï¸âƒ£ åœ¨ Helm æ¨¡æ¿ä¸­ï¼Œå˜é‡æ˜¯å¯¹å¦å¤–ä¸€ä¸ªå¯¹è±¡çš„å‘½åå¼•ç”¨ã€‚å®ƒéµå¾ª <code>$name</code> æ ¼å¼ï¼Œå˜é‡ä½¿ç”¨ç‰¹æ®Šçš„èµ‹å€¼è¿ç®—ç¬¦è¿›è¡Œèµ‹å€¼ <code>:=</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸Šé¢çš„æ¨¡æ¿ï¼Œä¸º <code>Release.Name</code> å£°æ˜ä¸€ä¸ªå˜é‡ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">$relname</span> <span class="string">:=</span> <span class="string">.Release.Name</span> <span class="string">-</span>&#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">with</span> <span class="string">.Values.favorite</span> &#125;&#125;</span><br><span class="line">  <span class="attr">drink:</span> &#123;&#123; <span class="string">.drink</span> <span class="string">|</span> <span class="string">default</span> <span class="string">&quot;tea&quot;</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">food:</span> &#123;&#123; <span class="string">.food</span> <span class="string">|</span> <span class="string">upper</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">release:</span> &#123;&#123; <span class="string">$relname</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">#values.yaml</span></span><br><span class="line"><span class="attr">favorite:</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">coffee</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">pizza</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„åœ¨ <code>with</code> è¯­å¥ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåˆ†é…äº† <code>$relname := .Release.Name</code>ï¼Œç„¶ååœ¨ <code>with</code> è¯­å¥å—ä¸­ï¼Œ<code>$relname</code> å˜é‡ä»ç„¶è¡¨ç¤º release çš„åç§°ï¼Œæˆ‘ä»¬æ¸²æŸ“è¯¥æ¨¡æ¿ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„æ­£ç¡®ç»“æœï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">âœ</span>   <span class="string">helm</span> <span class="string">install</span> <span class="string">--generate-name</span> <span class="string">--dry-run</span> <span class="string">./mychart</span></span><br><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line"><span class="comment">#ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1649378928-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;PIZZA&quot;</span></span><br><span class="line">  <span class="attr">release:</span> <span class="string">mychart-1649378928</span></span><br></pre></td></tr></table></figure>

<p>:warning: æ³¨æ„ï¼šè¿™ä¸ªå˜é‡çš„ä½ç½®å¯ä»¥æ”¾åœ¨æœ€ä¸Šé¢ï¼Œæ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯ä¸èƒ½æ”¾åœ¨withé‡Œé¢ã€‚</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220408085509475.png" alt="image-20220408085509475"></p>
<p>2ï¸âƒ£ å˜é‡åœ¨ <code>range</code> å¾ªç¯é‡Œé¢éå¸¸æœ‰ç”¨ï¼Œå®ƒä»¬å¯ä»¥ç”¨äºç±»ä¼¼äºåˆ—è¡¨çš„å¯¹è±¡æ¥æ•è·ç´¢å¼•å’Œ value å€¼ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">toppings:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">  &#123;&#123;- range $index, $topping := .Values.pizzaToppings &#125;&#125;</span></span><br><span class="line"><span class="string">  &#123;&#123; $index &#125;&#125;: &#123;&#123; $topping &#125;&#125;</span></span><br><span class="line"><span class="string">  &#123;&#123;- end &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ <code>range</code> åœ¨å‰é¢ï¼Œç„¶åæ˜¯å˜é‡ï¼Œç„¶åæ˜¯èµ‹å€¼è¿ç®—ç¬¦ï¼Œç„¶åæ‰æ˜¯åˆ—è¡¨ï¼Œè¿™ä¼šå°†æ•´æ•°ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰åˆ†é…ç»™ <code>$index</code>ï¼Œå¹¶å°† value å€¼åˆ†é…ç»™ <code>$topping</code>ï¼Œä¸Šé¢çš„å†…å®¹ä¼šè¢«æ¸²æŸ“æˆå¦‚ä¸‹å†…å®¹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">toppings:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">  0: mushrooms</span></span><br><span class="line"><span class="string">  1: cheese</span></span><br><span class="line"><span class="string">  2: peppers</span></span><br><span class="line"><span class="string">  3: onions</span></span><br></pre></td></tr></table></figure>

<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220408221206423.png" alt="image-20220408221206423"></p>
<p>å¯¹äºåŒæ—¶å…·æœ‰ key å’Œ value çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>range</code> æ¥è·å¾— keyã€value çš„å€¼ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åƒè¿™æ ·å¾ªç¯éå† <code>.Values.favorite</code>ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ConfigMap.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">range</span> <span class="string">$key</span>, <span class="string">$val</span> <span class="string">:=</span> <span class="string">.Values.favorite</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">$key</span> &#125;&#125;<span class="string">:</span> &#123;&#123; <span class="string">$val</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br><span class="line">  </span><br><span class="line"><span class="comment">#values.yaml</span></span><br><span class="line"><span class="attr">favorite:</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">coffee</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">pizza</span></span><br><span class="line"><span class="attr">pizzaToppings:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">mushrooms</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cheese</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">peppers</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">onions</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œ<code>$key</code> æ˜¯ <code>drink</code>ï¼Œ<code>$val</code> æ˜¯ <code>coffee</code>ï¼Œåœ¨ç¬¬äºŒæ¬¡è¿­ä»£ä¸­ï¼Œ<code>$key</code> æ˜¯ <code>food</code>ï¼Œ<code>$val</code> æ˜¯ <code>pizza</code>ã€‚è¿è¡Œä¸Šé¢çš„å‘½ä»¤å°†ç”Ÿæˆä¸‹é¢çš„å†…å®¹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">âœ</span>  <span class="string">helm</span> <span class="string">install</span> <span class="string">--generate-name</span> <span class="string">--dry-run</span> <span class="string">./mychart</span></span><br><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line"><span class="comment">#ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1649427327-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;pizza&quot;</span></span><br></pre></td></tr></table></figure>



<p>3ï¸âƒ£ ä¸€èˆ¬æ¥è¯´å˜é‡ä¸æ˜¯å…¨å±€çš„ï¼Œå®ƒä»¬çš„ä½œç”¨åŸŸæ˜¯å£°æ˜å®ƒä»¬çš„å—åŒºåŸŸã€‚ä¹‹å‰ï¼Œæˆ‘ä»¬åœ¨æ¨¡æ¿çš„é¡¶å±‚åˆ†é…äº† <code>$relname</code>ï¼Œè¯¥å˜é‡å°†åœ¨æ•´ä¸ªæ¨¡æ¿çš„èŒƒå›´å†…ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>$key</code> å’Œ <code>$val</code> ä½œç”¨åŸŸåªåœ¨ <code>&#123;&#123; range... &#125;&#125;&#123;&#123; end &#125;&#125;</code> åŒºåŸŸå†…ã€‚</p>
<p>ä½†æ˜¯ï¼Œ<strong>æœ‰ä¸€ä¸ªå§‹ç»ˆæ˜¯å…¨å±€å˜é‡çš„ <code>$</code> å§‹ç»ˆæŒ‡å‘é¡¶å±‚æ ¹ä¸Šä¸‹æ–‡</strong>ï¼Œå½“æˆ‘ä»¬åœ¨ <code>range</code> å¾ªç¯å†…éœ€è¦çŸ¥é“ chart åŒ…çš„ release åç§°çš„æ—¶å€™ï¼Œè¯¥åŠŸèƒ½å°±éå¸¸æœ‰ç”¨äº†ï¼Œæ¯”å¦‚ä¸‹é¢çš„æ¨¡æ¿æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">range</span> <span class="string">.Values.tlsSecrets</span> &#125;&#125;</span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.name</span> &#125;&#125;</span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="comment"># helm æ¨¡æ¿ç»å¸¸ä½¿ç”¨ `.`ï¼Œä½†æ˜¯è¿™é‡Œæ˜¯æ— æ•ˆçš„ï¼Œç”¨ `$` æ˜¯å¯ä»¥ç”Ÿæ•ˆçš„ã€‚</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/name:</span> &#123;&#123; <span class="string">template</span> <span class="string">&quot;fullname&quot;</span> <span class="string">$</span> &#125;&#125;</span><br><span class="line">    <span class="comment"># è¿™é‡Œä¸èƒ½å¼•ç”¨ `.Chart.Name`ï¼Œä½†æ˜¯å¯ç”¨ä½¿ç”¨ `$.Chart.Name`</span></span><br><span class="line">    <span class="attr">helm.sh/chart:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; $.Chart.Name &#125;&#125;</span>-<span class="template-variable">&#123;&#123; $.Chart.Version &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; $.Release.Name &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="comment"># å€¼æ¥è‡ªäº Chart.yaml æ–‡ä»¶ä¸­çš„ appVersion</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/version:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; $.Chart.AppVersion &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/managed-by:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; $.Release.Service &#125;&#125;</span>&quot;</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">kubernetes.io/tls</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">tls.crt:</span> &#123;&#123; <span class="string">.certificate</span> &#125;&#125;</span><br><span class="line">  <span class="attr">tls.key:</span> &#123;&#123; <span class="string">.key</span> &#125;&#125;</span><br><span class="line"><span class="meta">---</span></span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>



<p>æˆ‘ä»¬è¿™é‡Œç»§ç»­ç”¨ä¸Šé¢æ¡ˆä¾‹è¿›è¡Œæµ‹è¯•ï¼šè¿™é‡Œæˆ‘ä»¬å…ˆä½¿ç”¨<code>å˜é‡æ–¹å¼</code>æµ‹è¯•ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ConfigMap.yaml</span></span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">$relname</span> <span class="string">:=</span> <span class="string">.Release.Name</span> &#125;&#125;</span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">$chartName</span> <span class="string">:=</span> <span class="string">.Chart.Name</span>&#125;&#125;</span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">range</span> <span class="string">$key</span>, <span class="string">$val</span> <span class="string">:=</span> <span class="string">.Values.favorite</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">$key</span> &#125;&#125;<span class="string">:</span> &#123;&#123; <span class="string">$val</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">chartName:</span> &#123;&#123; <span class="string">$chartName</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#values.yaml</span></span><br><span class="line"><span class="attr">favorite:</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">coffee</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">pizza</span></span><br><span class="line"><span class="attr">pizzaToppings:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">mushrooms</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cheese</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">peppers</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">onions</span></span><br></pre></td></tr></table></figure>

<p>æ¸²æŸ“åå¯ä»¥å¾—åˆ°æ­£ç¡®ç»“æœï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">helm</span> <span class="string">install</span> <span class="string">--generate-name</span> <span class="string">--dry-run</span> <span class="string">./mychart</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line"><span class="comment">#ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1649431829-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  <span class="attr">chartName:</span> <span class="string">mychart</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;pizza&quot;</span></span><br><span class="line">  <span class="attr">chartName:</span> <span class="string">mychart</span></span><br></pre></td></tr></table></figure>



<p>æˆ‘ä»¬å†æ¬¡ä½¿ç”¨<code>å…¨å±€å˜é‡çš„ $</code>æ¥è¿›è¡Œæµ‹è¯•ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ConfigMap.yaml</span></span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">$relname</span> <span class="string">:=</span> <span class="string">.Release.Name</span> &#125;&#125;</span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">range</span> <span class="string">$key</span>, <span class="string">$val</span> <span class="string">:=</span> <span class="string">.Values.favorite</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">$key</span> &#125;&#125;<span class="string">:</span> &#123;&#123; <span class="string">$val</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">chartName:</span> &#123;&#123; <span class="string">$.Chart.Name</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">#values.yaml</span></span><br><span class="line"><span class="attr">favorite:</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">coffee</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">pizza</span></span><br><span class="line"><span class="attr">pizzaToppings:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">mushrooms</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cheese</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">peppers</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">onions</span></span><br></pre></td></tr></table></figure>

<p>åŒæ ·æ¸²æŸ“åå¯ä»¥å¾—åˆ°æ­£ç¡®ç»“æœï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">helm</span> <span class="string">install</span> <span class="string">--generate-name</span> <span class="string">--dry-run</span> <span class="string">./mychart</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line"><span class="comment">#ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1649432089-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  <span class="attr">chartName:</span> <span class="string">mychart</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;pizza&quot;</span></span><br><span class="line">  <span class="attr">chartName:</span> <span class="string">mychart</span></span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ç»“æŸã€‚ğŸ˜˜</p>
<p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªç ”ç©¶äº†åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å£°æ˜çš„ä¸€ä¸ªæ¨¡æ¿ï¼Œä½†æ˜¯ï¼Œ<strong>Helm æ¨¡æ¿è¯­è¨€çš„å¼ºå¤§åŠŸèƒ½ä¹‹ä¸€æ˜¯å®ƒèƒ½å¤Ÿå£°æ˜å¤šä¸ªæ¨¡æ¿å¹¶å°†å…¶ä¸€èµ·ä½¿ç”¨</strong>ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„ç« èŠ‚ä¸­æ¥è®¨è®ºè¿™ä¸€ç‚¹ã€‚</p>
<h2 id="6ã€å‘½åæ¨¡æ¿"><a href="#6ã€å‘½åæ¨¡æ¿" class="headerlink" title="6ã€å‘½åæ¨¡æ¿"></a>6ã€å‘½åæ¨¡æ¿</h2><p>å‰é¢æˆ‘ä»¬éƒ½æ˜¯åªæ“ä½œçš„ä¸€ä¸ªæ¨¡æ¿ï¼Œç°åœ¨æˆ‘ä»¬æ¥å°è¯•ä½¿ç”¨å¤šä¸ªæ¨¡æ¿æ–‡ä»¶ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥äº†è§£åˆ°<strong>å¦‚ä½•åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰å‘½åæ¨¡æ¿</strong>ï¼Œç„¶ååœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨å®ƒä»¬ã€‚å‘½åæ¨¡æ¿ï¼ˆæœ‰æ—¶ä¹Ÿå«<strong>å­æ¨¡æ¿</strong>ï¼‰åªæ˜¯åœ¨æ–‡ä»¶å†…éƒ¨å®šä¹‰çš„æœ‰åç§°çš„æ¨¡æ¿ã€‚ä¸»è¦æœ‰ä¸¤ç§åˆ›å»ºæ–¹å¼ä»¥åŠå‡ ç§ä¸åŒçš„ä½¿ç”¨æ–¹å¼ã€‚</p>
<p>å½“ä½¿ç”¨å‘½åæ¨¡æ¿çš„æ—¶å€™æœ‰å‡ ä¸ªé‡è¦ç»†èŠ‚ï¼šæ¨¡æ¿åç§°æ˜¯<strong>å…¨å±€</strong>çš„ï¼Œ<strong>å¦‚æœå£°æ˜ä¸¤ä¸ªå…·æœ‰ç›¸åŒåç§°çš„æ¨¡æ¿ï¼Œåˆ™ä¼šä½¿ç”¨æœ€åè¢«åŠ è½½çš„æ¨¡æ¿</strong>ã€‚ç”±äºå­ chart ä¸­çš„æ¨¡æ¿æ˜¯ä¸é¡¶çº§æ¨¡æ¿ä¸€èµ·ç¼–è¯‘çš„ï¼Œæ‰€ä»¥éœ€è¦è°¨æ…å‘½åã€‚</p>
<p>ä¸€ç§æµè¡Œçš„å‘½åçº¦å®šæ˜¯åœ¨æ¯ä¸ªå®šä¹‰çš„æ¨¡æ¿å‰æ·»åŠ  chart åç§°ï¼š<code>&#123;&#123; define "mychart.labels" &#125;&#125;</code>ï¼Œé€šè¿‡ä½¿ç”¨ç‰¹å®šçš„ chart åä½œä¸ºå‰ç¼€ï¼Œæˆ‘ä»¬å¯ä»¥é¿å…ç”±äºä¸¤ä¸ªä¸åŒçš„ chart å®ç°äº†ç›¸åŒåç§°çš„æ¨¡æ¿è€Œå¼•èµ·çš„å†²çªã€‚</p>
<h3 id="1-partials-å’Œ-æ–‡ä»¶"><a href="#1-partials-å’Œ-æ–‡ä»¶" class="headerlink" title="1.partials å’Œ _ æ–‡ä»¶"></a>1.partials å’Œ _ æ–‡ä»¶</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªä½¿ç”¨äº†ä¸€ä¸ªæ¨¡æ¿æ–‡ä»¶ï¼Œä½†æ˜¯ Helm çš„æ¨¡æ¿è¯­è¨€å…è®¸æˆ‘ä»¬åˆ›å»ºå‘½åçš„åµŒå…¥å¼æ¨¡æ¿ï¼Œå¯ä»¥åœ¨å…¶ä»–ä½ç½®è¿›è¡Œè®¿é—®ã€‚åœ¨ç¼–å†™è¿™äº›æ¨¡æ¿ä¹‹å‰ï¼Œæœ‰ä¸€äº›å€¼å¾—ä¸€æçš„å‘½åçº¦å®šï¼š</p>
<ul>
<li><code>templates/</code> ä¸­çš„å¤§å¤šæ•°æ–‡ä»¶éƒ½è¢«è§†ä¸º Kubernetes èµ„æºæ¸…å•æ–‡ä»¶ï¼ˆNOTES.txt é™¤å¤–ï¼‰</li>
<li>ä»¥ <code>_</code> å¼€å¤´å‘½åçš„æ–‡ä»¶ä¹Ÿä¸ä¼šè¢«å½“åš Kubernetes èµ„æºæ¸…å•æ–‡ä»¶</li>
<li>ä¸‹åˆ’çº¿å¼€å¤´çš„æ–‡ä»¶ä¸ä¼šè¢«å½“åšèµ„æºæ¸…å•ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è¢«å…¶ä»– chart æ¨¡æ¿è°ƒç”¨</li>
</ul>
<p><code>_</code> å¼€å¤´çš„è¿™äº›æ–‡ä»¶å…¶å®å°±æ˜¯ Helm ä¸­çš„ <code>partials</code> æ–‡ä»¶ï¼Œæ‰€ä»¥å…¶å®æˆ‘ä»¬å®Œå…¨å¯ä»¥å°†å‘½åæ¨¡æ¿å®šä¹‰åœ¨è¿™äº› <code>partials</code> æ–‡ä»¶ä¸­ï¼Œé»˜è®¤å°±æ˜¯ <code>_helpers.tpl</code> æ–‡ä»¶ï¼Œå…¶å®åœ¨å‰é¢æˆ‘ä»¬åˆ›å»ºçš„ <code>mychart</code> åŒ…ä¸­ä¹Ÿå¯ä»¥æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚</p>
<h3 id="2-define-å’Œ-template"><a href="#2-define-å’Œ-template" class="headerlink" title="2.define å’Œ template"></a>2.<code>define</code> å’Œ <code>template</code></h3><table><tr><td bgcolor=yellow>ğŸ’˜ ç¤ºä¾‹ï¼šdefineå’Œtemplateæµ‹è¯•-2022.4.9(æµ‹è¯•æˆåŠŸ)</td></tr></table>

<p><code>define</code> å…³é”®å­—å¯ä»¥è®©æˆ‘ä»¬åœ¨æ¨¡æ¿æ–‡ä»¶ä¸­åˆ›å»ºå‘½åæ¨¡æ¿ï¼Œå®ƒçš„è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; <span class="string">define</span> <span class="string">&quot;MY.NAME&quot;</span> &#125;&#125;</span><br><span class="line">  <span class="comment"># æ¨¡æ¿å†…å®¹åŒºåŸŸ</span></span><br><span class="line">&#123;&#123; <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>



<p>1ï¸âƒ£ <code>å°†å‘½åæ¨¡æ¿æ”¾åœ¨æ¨¡æ¿æ–‡ä»¶é‡Œ</code></p>
<p>æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªæ¨¡æ¿æ¥å°è£…ä¸‹ Kubernetes çš„ labels æ ‡ç­¾ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">define</span> <span class="string">&quot;mychart.labels&quot;</span> &#125;&#125;</span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">generator:</span> <span class="string">helm</span></span><br><span class="line">    <span class="attr">date:</span> &#123;&#123; <span class="string">now</span> <span class="string">|</span> <span class="string">htmlDate</span> &#125;&#125;</span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å°†è¯¥æ¨¡æ¿åµŒå…¥åˆ°å‰é¢çš„ ConfigMap æ¨¡æ¿ä¸­ï¼Œç„¶åå°†å…¶åŒ…å«åœ¨æ¨¡æ¿ä¸­ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">define</span> <span class="string">&quot;mychart.labels&quot;</span> &#125;&#125;</span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">generator:</span> <span class="string">helm</span></span><br><span class="line">    <span class="attr">date:</span> &#123;&#123; <span class="string">now</span> <span class="string">|</span> <span class="string">htmlDate</span> &#125;&#125;</span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">template</span> <span class="string">&quot;mychart.labels&quot;</span> &#125;&#125;</span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">range</span> <span class="string">$key</span>, <span class="string">$val</span> <span class="string">:=</span> <span class="string">.Values.favorite</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">$key</span> &#125;&#125;<span class="string">:</span> &#123;&#123; <span class="string">$val</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å½“æ¨¡æ¿å¼•æ“è¯»å–è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œå®ƒä¼šå­˜å‚¨ <code>mychart.labels</code> çš„å¼•ç”¨ï¼Œç›´åˆ°è¯¥æ¨¡æ¿è¢«è°ƒç”¨ï¼Œç„¶åä¼šå†…è”æ¸²æŸ“è¯¥æ¨¡æ¿ã€‚æˆ‘ä»¬æ¸²æŸ“è¿™ä¸ªæ¨¡æ¿å¯ä»¥éƒ½åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„ç»“æœï¼ˆè®°å¾—å…ˆåˆ æ‰é»˜è®¤ç”Ÿæˆçš„ <code>_helpers.tpl</code> æ–‡ä»¶ï¼‰ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">âœ</span>  <span class="string">helm</span> <span class="string">install</span> <span class="string">--generate-name</span> <span class="string">--dry-run</span> <span class="string">./mychart</span></span><br><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line"><span class="comment">#ConfigMap.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1649491252-configmap</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">     <span class="attr">generator:</span> <span class="string">helm</span></span><br><span class="line">     <span class="attr">date:</span> <span class="number">2022-04-09</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  <span class="attr">chartName:</span> <span class="string">mychart</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;pizza&quot;</span></span><br><span class="line">  <span class="attr">chartName:</span> <span class="string">mychart</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>2ï¸âƒ£ <code>å°†å‘½åæ¨¡æ¿æ”¾åœ¨_helpers.tplé‡Œ</code></p>
<p>ä¸€èˆ¬æ¥è¯´ï¼ŒHelm ä¸­çº¦å®šå°†è¿™äº›æ¨¡æ¿ç»Ÿä¸€æ”¾åˆ°ä¸€ä¸ª partials æ–‡ä»¶ä¸­ï¼Œé€šå¸¸å°±æ˜¯ <code>_helpers.tpl</code> æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å°†ä¸Šé¢çš„å‘½åæ¨¡æ¿ç§»åŠ¨åˆ°è¯¥æ–‡ä»¶ï¼ˆ<code>templates/_helpers.tpl</code>ï¼‰ä¸­å»ï¼š</p>
<p>è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸‹è¿™ä¸ª<code>_helpers.tpl</code>æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="string">/*</span> <span class="string">ç”ŸæˆåŸºæœ¬çš„</span> <span class="string">Label</span> <span class="string">æ ‡ç­¾</span> <span class="string">*/</span>&#125;&#125;</span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">define</span> <span class="string">&quot;mychart.labels&quot;</span> &#125;&#125;</span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">generator:</span> <span class="string">helm</span></span><br><span class="line">    <span class="attr">date:</span> &#123;&#123; <span class="string">now</span> <span class="string">|</span> <span class="string">htmlDate</span> &#125;&#125;</span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¹Ÿä¼šç”¨ä¸€ä¸ªç®€å•çš„å—ï¼ˆ<code>&#123;&#123;/*...*/&#125;&#125;</code>ï¼‰æ¥æ³¨é‡Šè¿™ä¸ªå‘½åæ¨¡æ¿çš„ä½œç”¨ã€‚</p>
<p>ç°åœ¨è™½ç„¶æˆ‘ä»¬æŠŠå‘½åæ¨¡æ¿æ”¾åˆ°äº† <code>_helpers.tpl</code> æ–‡ä»¶ä¸­ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ <code>configmap.yaml</code> æ¨¡æ¿ä¸­è¿˜æ˜¯å¯ä»¥è®¿é—®ï¼Œå› ä¸ºå‘½åæ¨¡æ¿æ˜¯å…¨å±€çš„ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">template</span> <span class="string">&quot;mychart.labels&quot;</span> &#125;&#125;</span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">range</span> <span class="string">$key</span>, <span class="string">$val</span> <span class="string">:=</span> <span class="string">.Values.favorite</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">$key</span> &#125;&#125;<span class="string">:</span> &#123;&#123; <span class="string">$val</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºä¸Šé¢æˆ‘ä»¬æåˆ°è¿‡å‘½åæ¨¡æ¿æ˜¯å…¨å±€çš„ï¼Œæˆ‘ä»¬å¯ä»¥å†æ¸²æŸ“ä¸‹ä¸Šé¢çš„æ¨¡æ¿å¯ä»¥å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220409160431607.png" alt="image-20220409160431607"></p>
<p>æµ‹è¯•ç»“æŸã€‚ğŸ˜˜</p>
<h3 id="3-è®¾ç½®æ¨¡æ¿èŒƒå›´"><a href="#3-è®¾ç½®æ¨¡æ¿èŒƒå›´" class="headerlink" title="3.è®¾ç½®æ¨¡æ¿èŒƒå›´"></a>3.è®¾ç½®æ¨¡æ¿èŒƒå›´</h3><table><tr><td bgcolor=yellow>ğŸ’˜ ç¤ºä¾‹ï¼šè®¾ç½®æ¨¡æ¿èŒƒå›´-2022.4.9(æµ‹è¯•æˆåŠŸ)</td></tr></table>

<p>1ï¸âƒ£ ä¸Šé¢æˆ‘ä»¬å®šä¹‰çš„æ¨¡æ¿ä¸­ï¼Œè¿˜æ²¡æœ‰ä½¿ç”¨åˆ°ä»»ä½•å¯¹è±¡ï¼Œåªä½¿ç”¨äº†å‡½æ•°ï¼Œç°åœ¨æˆ‘ä»¬æ¥ä¿®æ”¹ä¸‹å®šä¹‰çš„å‘½åæ¨¡æ¿ï¼ŒåŒ…å« chart çš„åç§°å’Œç‰ˆæœ¬ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _heplers.tpl</span></span><br><span class="line">&#123;&#123;<span class="string">/*</span> <span class="string">ç”ŸæˆåŸºæœ¬çš„</span> <span class="string">Label</span> <span class="string">æ ‡ç­¾</span> <span class="string">*/</span>&#125;&#125;</span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">define</span> <span class="string">&quot;mychart.labels&quot;</span> &#125;&#125;</span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">generator:</span> <span class="string">helm</span></span><br><span class="line">    <span class="attr">date:</span> &#123;&#123; <span class="string">now</span> <span class="string">|</span> <span class="string">htmlDate</span> &#125;&#125;</span><br><span class="line">    <span class="attr">chartName:</span> &#123;&#123; <span class="string">.Chart.Name</span> &#125;&#125;</span><br><span class="line">    <span class="attr">chartVersion:</span> &#123;&#123; <span class="string">.Chart.Version</span> &#125;&#125;</span><br><span class="line">    <span class="attr">releaseName:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;</span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬æ¥æ¸²æŸ“ä¸‹æ¨¡æ¿ï¼Œä¼šå‡ºç°ä¸‹é¢çš„é”™è¯¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">âœ  helm install --generate-name --dry-run ./mychart</span><br><span class="line">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/hg/.kube/config</span><br><span class="line">WARNING: Kubernetes configuration file is world-readable. This is insecure. Location: /home/hg/.kube/config</span><br><span class="line">Error: INSTALLATION FAILED: unable to build kubernetes objects from release manifest: error validating <span class="string">&quot;&quot;</span>: error validating data: [unknown object <span class="built_in">type</span> <span class="string">&quot;nil&quot;</span> <span class="keyword">in</span> ConfigMap.metadata.labels.chartName, unknown object <span class="built_in">type</span> <span class="string">&quot;nil&quot;</span> <span class="keyword">in</span> ConfigMap.metadata.labels.chartVersion, unknown object <span class="built_in">type</span> <span class="string">&quot;nil&quot;</span> <span class="keyword">in</span> ConfigMap.metadata.labels.releaseName]</span><br><span class="line">â€¦â€¦</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æç¤º <code>labels.chart</code> ä¸º <code>nil</code>ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„ <code>.Chart.Name</code> ä¸åœ¨å®šä¹‰çš„è¿™ä¸ªæ¨¡æ¿çš„ä½œç”¨åŸŸèŒƒå›´å†…ï¼Œå½“æ¸²æŸ“å‘½åæ¨¡æ¿ï¼ˆä½¿ç”¨ <code>define</code> å®šä¹‰ï¼‰çš„æ—¶å€™ï¼Œå®ƒå°†æ¥æ”¶æ¨¡æ¿è°ƒç”¨ä¼ é€’çš„ä½œç”¨åŸŸã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ˜¯è¿™æ ·å¼•ç”¨è¿™ä¸ªæ¨¡æ¿çš„ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">template</span> <span class="string">&quot;mychart.labels&quot;</span> &#125;&#125;</span><br></pre></td></tr></table></figure>



<p>2ï¸âƒ£ æ²¡æœ‰ä¼ å…¥ä»»ä½•ä½œç”¨åŸŸï¼Œæ‰€ä»¥åœ¨æ¨¡æ¿å†…æˆ‘ä»¬æ— æ³•è®¿é—® <code>.</code> ä¸­çš„ä»»ä½•å†…å®¹ï¼Œå½“ç„¶è¦è§£å†³å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠä½œç”¨åŸŸèŒƒå›´ä¼ é€’ç»™æ¨¡æ¿å³å¯ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ConfigMap.yaml</span></span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">$relname</span> <span class="string">:=</span> <span class="string">.Release.Name</span> &#125;&#125;</span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">template</span> <span class="string">&quot;mychart.labels&quot;</span> <span class="string">.</span> &#125;&#125;</span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">range</span> <span class="string">$key</span>, <span class="string">$val</span> <span class="string">:=</span> <span class="string">.Values.favorite</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">$key</span> &#125;&#125;<span class="string">:</span> &#123;&#123; <span class="string">$val</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  <span class="attr">chartName:</span> &#123;&#123; <span class="string">$.Chart.Name</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬è¿™é‡Œåœ¨ä½¿ç”¨ <code>template</code> è°ƒç”¨æ¨¡æ¿çš„æ—¶å€™ä¼ é€’äº† <code>.</code>ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“ä¼ é€’ <code>.Values</code> æˆ–è€… <code>.Values.favorite</code> æˆ–è€…æˆ‘ä»¬æƒ³è¦çš„ä»»ä½•èŒƒå›´ï¼Œä½†æ˜¯è¿™é‡Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯é¡¶çº§ä½œç”¨åŸŸï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ é€’çš„æ˜¯ <code>.</code>ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬å†æ¥é‡æ–°æ¸²æŸ“æˆ‘ä»¬çš„æ¨¡æ¿ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„ç»“æœï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line"><span class="comment">#ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1649492314-configmap</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">generator:</span> <span class="string">helm</span></span><br><span class="line">    <span class="attr">date:</span> <span class="number">2022-04-09</span></span><br><span class="line">    <span class="attr">chartName:</span> <span class="string">mychart</span></span><br><span class="line">    <span class="attr">chartVersion:</span> <span class="number">0.1</span><span class="number">.0</span></span><br><span class="line">    <span class="attr">releaseName:</span> <span class="string">mychart-1649492314</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  <span class="attr">chartName:</span> <span class="string">mychart</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;pizza&quot;</span></span><br><span class="line">  <span class="attr">chartName:</span> <span class="string">mychart</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ <code>&#123;&#123; .Chart.Name &#125;&#125;</code> è§£æä¸ºäº† mychartï¼Œè€Œ <code>&#123;&#123; .Chart.Version &#125;&#125;</code> è§£æä¸ºäº† <code>0.1.0</code>ã€‚</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220409162002848.png" alt="image-20220409162002848"></p>
<p>æµ‹è¯•ç»“æŸã€‚ğŸ˜˜</p>
<h3 id="4-include-å‡½æ•°"><a href="#4-include-å‡½æ•°" class="headerlink" title="4.include å‡½æ•°"></a>4.include å‡½æ•°</h3><table><tr><td bgcolor=yellow>ğŸ’˜ ç¤ºä¾‹ï¼šincludeå‡½æ•°-2022.4.9(æµ‹è¯•æˆåŠŸ)</td></tr></table>

<p>1ï¸âƒ£ å‡è®¾æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¦‚ä¸‹æ‰€ç¤ºçš„ç®€å•æ¨¡æ¿ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _helpers.tpl</span></span><br><span class="line">&#123;&#123;<span class="string">/*</span> <span class="string">å®šä¹‰ä¸€ä¸ªç®€å•çš„chart</span> <span class="string">appæ¨¡æ¿*/</span>&#125;&#125;</span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">define</span> <span class="string">&quot;mychart.app&quot;</span> <span class="string">-</span>&#125;&#125;</span><br><span class="line"><span class="attr">app_name:</span> &#123;&#123; <span class="string">.Chart.Name</span> &#125;&#125;</span><br><span class="line"><span class="attr">app_version:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; .Chart.Version &#125;&#125;</span>&quot;</span></span><br><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">end</span> <span class="string">-</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬æƒ³æŠŠä¸Šé¢çš„å†…å®¹æ’å…¥åˆ°æ¨¡æ¿çš„ <code>labels</code> éƒ¨åˆ†ï¼Œåœ¨ <code>data</code> éƒ¨åˆ†ä¹Ÿæƒ³è¦è¿™ä¸ªå†…å®¹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    &#123;&#123; <span class="string">template</span> <span class="string">&quot;mychart.app&quot;</span> <span class="string">.</span> &#125;&#125;</span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">range</span> <span class="string">$key</span>, <span class="string">$val</span> <span class="string">:=</span> <span class="string">.Values.favorite</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">$key</span> &#125;&#125;<span class="string">:</span> &#123;&#123; <span class="string">$val</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">template</span> <span class="string">&quot;mychart.app&quot;</span> <span class="string">.</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æˆ‘ä»¬ç›´æ¥æ¸²æŸ“ä¸Šé¢çš„æ¨¡æ¿è¿˜æ˜¯ä¼šæœ‰é”™è¯¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">âœ  helm install --generate-name --dry-run ./mychart</span><br><span class="line">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/hg/.kube/config</span><br><span class="line">WARNING: Kubernetes configuration file is world-readable. This is insecure. Location: /home/hg/.kube/config</span><br><span class="line">Error: INSTALLATION FAILED: unable to build kubernetes objects from release manifest: error validating <span class="string">&quot;&quot;</span>: error validating data: ValidationError(ConfigMap): unknown field <span class="string">&quot;app_version&quot;</span> <span class="keyword">in</span> io.k8s.api.core.v1.ConfigMap</span><br><span class="line">âœ  local-vscode</span><br></pre></td></tr></table></figure>

<p>å› ä¸º <code>template</code> åªæ˜¯ä¸€ä¸ªåŠ¨ä½œï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥æ— æ³•å°†æ¨¡æ¿è°ƒç”¨çš„è¾“å‡ºä¼ é€’ç»™å…¶ä»–å‡½æ•°ï¼Œåªæ˜¯å†…è”æ’å…¥ï¼Œç›¸å½“äºæ¸²æŸ“çš„ç»“æœæ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">measly-whippet-configmap</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app_name:</span> <span class="string">mychart</span></span><br><span class="line"><span class="attr">app_version:</span> <span class="string">&quot;0.1.0+1478129847&quot;</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;pizza&quot;</span></span><br><span class="line">  <span class="attr">app_name:</span> <span class="string">mychart</span></span><br><span class="line"><span class="attr">app_version:</span> <span class="string">&quot;0.1.0+1478129847&quot;</span></span><br></pre></td></tr></table></figure>



<p>:warning: éœ€è¦æ³¨æ„ï¼š</p>
<p>2ï¸âƒ£ å¾ˆæ˜æ˜¾ä¸Šé¢çš„ YAML æ–‡ä»¶æ˜¯ä¸ç¬¦åˆ ConfigMap èµ„æºå¯¹è±¡çš„æ ¼å¼è¦æ±‚çš„ï¼Œæ‰€ä»¥æŠ¥é”™äº†ã€‚ä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒHelm æä¾›äº†ä»£æ›¿ <code>template</code> çš„å‡½æ•° <code>include</code>ï¼Œå¯ä»¥å°†æ¨¡æ¿çš„å†…å®¹å¯¼å…¥åˆ°å½“å‰çš„ç®¡é“ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ç®¡é“ä¸­ä¼ é€’ç»™å…¶ä»–å‡½æ•°è¿›è¡Œå¤„ç†äº†ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">&#123;&#123; <span class="string">include</span> <span class="string">&quot;mychart.app&quot;</span> <span class="string">.</span> <span class="string">|</span> <span class="string">indent</span> <span class="number">4</span> &#125;&#125;</span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">range</span> <span class="string">$key</span>, <span class="string">$val</span> <span class="string">:=</span> <span class="string">.Values.favorite</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">$key</span> &#125;&#125;<span class="string">:</span> &#123;&#123; <span class="string">$val</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br><span class="line">&#123;&#123; <span class="string">include</span> <span class="string">&quot;mychart.app&quot;</span> <span class="string">.</span> <span class="string">|</span> <span class="string">indent</span> <span class="number">2</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨æˆ‘ä»¬é‡æ–°æ¸²æŸ“å°±å¯ä»¥å¾—åˆ°æ­£ç¡®çš„ç»“æœäº†ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬ç”¨ <code>include</code> å‡½æ•°å¾—åˆ°æ¨¡æ¿å†…å®¹åé€šè¿‡ç®¡é“ä¼ ç»™äº†åé¢çš„ <code>indent</code> å‡½æ•°æ¥ä¿è¯äº†ç¼©è¿›ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="attr">Source:</span> <span class="string">mychart/templates/configmap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1576036671-configmap</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app_name:</span> <span class="string">mychart</span></span><br><span class="line">    <span class="attr">app_version:</span> <span class="string">&quot;0.1.0&quot;</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">myvalue:</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">&quot;coffee&quot;</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">&quot;pizza&quot;</span></span><br><span class="line">  <span class="attr">app_name:</span> <span class="string">mychart</span></span><br><span class="line">  <span class="attr">app_version:</span> <span class="string">&quot;0.1.0&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220409171721036.png" alt="image-20220409171721036"></p>
<p>:warning: å»ºè®®</p>
<blockquote>
<p>åœ¨ Helm æ¨¡æ¿ä¸­æœ€å¥½ä½¿ç”¨ <code>include</code> è€Œä¸æ˜¯ <code>template</code>ï¼Œè¿™æ ·å¯ä»¥æ›´å¥½åœ°å¤„ç† YAML æ–‡æ¡£çš„è¾“å‡ºæ ¼å¼ã€‚</p>
<p>æœ‰æ—¶å€™å¦‚æœæˆ‘ä»¬åªæƒ³å¯¼å…¥å†…å®¹è€Œä¸æ˜¯æ¨¡æ¿ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢æè¿°çš„ <code>.Files</code> å¯¹è±¡æ¥è®¿é—®æ–‡ä»¶å®ç°ã€‚</p>
</blockquote>
<p>æµ‹è¯•ç»“æŸã€‚ğŸ˜˜</p>
<h2 id="7ã€è®¿é—®æ–‡ä»¶"><a href="#7ã€è®¿é—®æ–‡ä»¶" class="headerlink" title="7ã€è®¿é—®æ–‡ä»¶"></a>7ã€è®¿é—®æ–‡ä»¶</h2><p>åœ¨ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬ä»‹ç»äº†å‡ ç§åˆ›å»ºå’Œè®¿é—®å‘½åæ¨¡æ¿çš„æ–¹æ³•ï¼Œè¿™ä½¿å¾—ä»å¦ä¸€ä¸ªæ¨¡æ¿ä¸­å¯¼å…¥ä¸€ä¸ªæ¨¡æ¿å˜å¾—å¾ˆå®¹æ˜“ï¼Œä½†æ˜¯æœ‰æ—¶å€™éœ€è¦å¯¼å…¥ä¸€ä¸ªä¸æ˜¯æ¨¡æ¿çš„æ–‡ä»¶å¹¶æ³¨å…¥å…¶å†…å®¹ï¼Œè€Œä¸é€šè¿‡æ¨¡æ¿æ¸²æŸ“å™¨è·å¾—å†…å®¹ã€‚</p>
<p>Helm æä¾›äº†ä¸€ä¸ª <code>.Files</code> å¯¹è±¡å¯¹æ–‡ä»¶çš„è®¿é—®ï¼Œä½†æ˜¯åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨è¿™ä¸ªå¯¹è±¡ä¹‹å‰ï¼Œè¿˜æœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„äº‹é¡¹å€¼å¾—ä¸€æï¼š</p>
<ul>
<li><p>å¯ä»¥åœ¨ Helm chart ä¸­æ·»åŠ é¢å¤–çš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶ä¹Ÿä¼šè¢«æ‰“åŒ…ï¼Œä¸è¿‡éœ€è¦æ³¨æ„ï¼Œç”±äº Kubernetes å¯¹è±¡çš„å­˜å‚¨é™åˆ¶ï¼Œ<strong>Charts å¿…é¡»å°äº 1M</strong></p>
</li>
<li><p>ç”±äºä¸€äº›å®‰å…¨åŸå› ï¼Œé€šè¿‡ <code>.Files</code> å¯¹è±¡æ— æ³•è®¿é—®æŸäº›æ–‡ä»¶</p>
<ul>
<li>æ— æ³•è®¿é—® <code>templates/</code> ä¸‹é¢çš„æ–‡ä»¶</li>
<li>æ— æ³•è®¿é—®ä½¿ç”¨ <code>.helmignore</code> æ’é™¤çš„æ–‡ä»¶</li>
</ul>
</li>
<li><p>Chart ä¸ä¼šä¿ç•™ UNIX æ¨¡å¼çš„ä¿¡æ¯ï¼Œæ‰€ä»¥ï¼Œå½“ä½¿ç”¨ <code>.Files</code> å¯¹è±¡æ—¶ï¼Œæ–‡ä»¶çº§åˆ«çš„æƒé™ä¸ä¼šå¯¹æ–‡ä»¶çš„å¯ç”¨æ€§äº§ç”Ÿå½±å“ã€‚ğŸ˜¥</p>
</li>
</ul>
<h3 id="1-åŸºæœ¬ç¤ºä¾‹"><a href="#1-åŸºæœ¬ç¤ºä¾‹" class="headerlink" title="1.åŸºæœ¬ç¤ºä¾‹"></a>1.åŸºæœ¬ç¤ºä¾‹</h3><table><tr><td bgcolor=yellow>ğŸ’˜ ç¤ºä¾‹ï¼šè®¿é—®æ–‡ä»¶åŸºæœ¬ç¤ºä¾‹-2022.4.9(æµ‹è¯•æˆåŠŸ)</td></tr></table>

<p>1ï¸âƒ£ ç°åœ¨æˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸ªæ¨¡æ¿ï¼Œå°†3ä¸ªæ–‡ä»¶è¯»å…¥åˆ° <code>ConfigMap</code> æ¨¡æ¿ä¸­ï¼Œé¦–å…ˆæˆ‘ä»¬åœ¨ chart ä¸­æ·»åŠ 3ä¸ªæ–‡ä»¶ï¼Œå°†3ä¸ªæ–‡ä»¶éƒ½ç›´æ¥æ”¾ç½®åœ¨ <code>mychart/</code> ç›®å½•ä¸­ã€‚</p>
<p><code>config1.toml</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">message = Hello from config 1</span><br></pre></td></tr></table></figure>

<p><code>config2.toml</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">message = Hello from config 2</span><br></pre></td></tr></table></figure>

<p><code>config3.toml</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">message = Hello from config 3</span><br></pre></td></tr></table></figure>



<p>2ï¸âƒ£ 3ä¸ªæ–‡ä»¶éƒ½æ˜¯ç®€å•çš„ TOML æ–‡ä»¶ï¼Œæˆ‘ä»¬çŸ¥é“è¿™äº›æ–‡ä»¶çš„åç§°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>range</code> å‡½æ•°æ¥éå†å®ƒä»¬ï¼Œå¹¶å°†å…¶å†…å®¹æ³¨å…¥åˆ° <code>ConfigMap</code> ä¸­å»ã€‚</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">$files</span> <span class="string">:=</span> <span class="string">.Files</span> &#125;&#125;</span><br><span class="line">  &#123;&#123;<span class="bullet">-</span> <span class="string">range</span> <span class="string">tuple</span> <span class="string">&quot;config1.toml&quot;</span> <span class="string">&quot;config2.toml&quot;</span> <span class="string">&quot;config3.toml&quot;</span> &#125;&#125;</span><br><span class="line">  &#123;&#123; <span class="string">.</span> &#125;&#125;<span class="string">:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    &#123;&#123; $files.Get . &#125;&#125;</span></span><br><span class="line"><span class="string"></span>  &#123;&#123;<span class="bullet">-</span> <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ª <code>$files</code> çš„å˜é‡æ¥ä¿å­˜ <code>.Files</code> å¯¹è±¡çš„å¼•ç”¨ï¼Œè¿˜ä½¿ç”¨äº† <code>tuple</code> å‡½æ•°æ¥å¾ªç¯æ–‡ä»¶åˆ—è¡¨ï¼Œç„¶åæˆ‘ä»¬æ‰“å°æ¯ä¸ªæ–‡ä»¶å¤¹ <code>&#123;&#123; . &#125;&#125;: |-</code>ï¼Œåé¢ä½¿ç”¨ <code>&#123;&#123; $files.Get . &#125;&#125;</code> è·å–æ–‡ä»¶å†…å®¹ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æ¸²æŸ“è¿™ä¸ªæ¨¡æ¿ä¼šäº§ç”ŸåŒ…å«3ä¸ªæ–‡ä»¶å†…å®¹çš„å•ä¸ª ConfigMapï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Source: mychart/templates/ConfigMap.yaml</span></span><br><span class="line"><span class="comment">#ConfigMap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1649497695-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">config1.toml:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    message = Hello from config 1</span></span><br><span class="line"><span class="string"></span>  <span class="attr">config2.toml:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    message = Hello from config 2</span></span><br><span class="line"><span class="string"></span>  <span class="attr">config3.toml:</span> <span class="string">|-</span></span><br><span class="line">    <span class="string">message</span> <span class="string">=</span> <span class="string">Hello</span> <span class="string">from</span> <span class="string">config</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220409174907397.png" alt="image-20220409174907397"></p>
<p>:warning: æ³¨æ„ï¼š</p>
<p>å¦å¤–åœ¨å¤„ç†æ–‡ä»¶çš„æ—¶å€™ï¼Œå¯¹æ–‡ä»¶è·¯å¾„æœ¬èº«æ‰§è¡Œä¸€äº›æ ‡å‡†æ“ä½œå¯èƒ½éå¸¸æœ‰ç”¨ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒHelm ä» Go çš„è·¯å¾„åŒ…ä¸­å¯¼å…¥äº†è®¸å¤šåŠŸèƒ½ä¾›ä½ ä½¿ç”¨ï¼Œå®ƒä»¬éƒ½å¯ä»¥ä½¿ç”¨ä¸ Go åŒ…ä¸­ç›¸åŒçš„ç›¸åŒåç§°æ¥è®¿é—®ï¼Œä½†æ˜¯é¦–å­—æ¯éœ€è¦å°å†™ï¼Œæ¯”å¦‚ Base éœ€è¦å˜æˆ baseï¼Œå¯¼å…¥çš„å‡½æ•°æœ‰ï¼š- Base - Dir - Ext - IsAbs - Cleanã€‚</p>
<p>æµ‹è¯•ç»“æŸã€‚ğŸ˜˜</p>
<h3 id="2-Glob-æ¨¡å¼"><a href="#2-Glob-æ¨¡å¼" class="headerlink" title="2.Glob æ¨¡å¼"></a>2.Glob æ¨¡å¼</h3><p>éšç€ chart çš„å¢é•¿ï¼Œä½ å¯èƒ½éœ€è¦æ›´å¤šåœ°ç»„ç»‡æ–‡ä»¶ï¼Œå› æ­¤ Helm æä¾›äº† <code>Files.Glob</code> çš„æ–¹æ³•æ¥å¸®åŠ©æˆ‘ä»¬è·å–å…·æœ‰ <code>glob</code> æ¨¡å¼çš„æ–‡ä»¶ã€‚</p>
<p><code>.Glob</code> è¿”å› <code>Files</code> ç±»å‹ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨è¿”å›çš„å¯¹è±¡ä¸Šè°ƒç”¨ä»»ä½• <code>Files</code> æ–¹æ³•ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬çš„æ–‡ä»¶ç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">foo/:</span></span><br><span class="line">  <span class="string">foo.txt</span> <span class="string">foo.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">bar/:</span></span><br><span class="line">  <span class="string">bar.go</span> <span class="string">bar.conf</span> <span class="string">baz.yaml</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥ç”¨ <code>Glob</code> è¿›è¡Œå¤šç§é€‰æ‹©ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; <span class="string">range</span> <span class="string">$path</span> <span class="string">:=</span> <span class="string">.Files.Glob</span> <span class="string">&quot;**.yaml&quot;</span> &#125;&#125;</span><br><span class="line">&#123;&#123; <span class="string">$path</span> &#125;&#125;<span class="string">:</span> <span class="string">|</span></span><br><span class="line">&#123;&#123; <span class="string">.Files.Get</span> <span class="string">$path</span> &#125;&#125;</span><br><span class="line">&#123;&#123; <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; <span class="string">range</span> <span class="string">$path</span>, <span class="string">$bytes</span> <span class="string">:=</span> <span class="string">.Files.Glob</span> <span class="string">&quot;foo/*&quot;</span> &#125;&#125;</span><br><span class="line">&#123;&#123; <span class="string">$path</span> &#125;&#125;<span class="string">:</span> <span class="string">&#x27;<span class="template-variable">&#123;&#123; b64enc $bytes &#125;&#125;</span>&#x27;</span></span><br><span class="line">&#123;&#123; <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-ConfigMap-å’Œ-Secrets"><a href="#3-ConfigMap-å’Œ-Secrets" class="headerlink" title="3.ConfigMap å’Œ Secrets"></a>3.ConfigMap å’Œ Secrets</h3><p>æƒ³è¦å°†æ–‡ä»¶å†…å®¹åŒæ—¶æ”¾å…¥ ConfigMap å’Œ Secrets ä¸­ï¼Œä»¥ä¾¿åœ¨è¿è¡Œæ—¶å®‰è£…åˆ° Pod ä¸­ï¼Œè¿™ç§éœ€æ±‚å¾ˆå¸¸è§ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒHelm åœ¨ <code>Files</code> ç±»å‹ä¸Šæ·»åŠ äº†ä¸€ä¸ªå®ç”¨çš„æ–¹æ³•ã€‚</p>
<p>æ ¹æ®ä¸Šé¢çš„ç›®å½•ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹çš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">conf</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">&#123;&#123; <span class="string">(.Files.Glob</span> <span class="string">&quot;foo/*&quot;</span><span class="string">).AsConfig</span> <span class="string">|</span> <span class="string">indent</span> <span class="number">2</span> &#125;&#125;</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">very-secret</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">&#123;&#123; <span class="string">(.Files.Glob</span> <span class="string">&quot;bar/*&quot;</span><span class="string">).AsSecrets</span> <span class="string">|</span> <span class="string">indent</span> <span class="number">2</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-ç¼–ç "><a href="#4-ç¼–ç " class="headerlink" title="4.ç¼–ç "></a>4.ç¼–ç </h3><table><tr><td bgcolor=yellow>ğŸ’˜ ç¤ºä¾‹ï¼šç¼–ç -2022.4.9(æµ‹è¯•æˆåŠŸ)</td></tr></table>

<p>1ï¸âƒ£ æˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¼å…¥ä¸€ä¸ªæ–‡ä»¶å¹¶ç”¨ <code>base64</code> ç¼–ç è¿›è¡Œç¼–ç ï¼š</p>
<p>æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ª<code>templates/secret.yaml</code>æ¨¡æ¿æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-secret</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">token:</span> <span class="string">|-</span></span><br><span class="line">    &#123;&#123; <span class="string">.Files.Get</span> <span class="string">&quot;config1.toml&quot;</span> <span class="string">|</span> <span class="string">b64enc</span> &#125;&#125;</span><br></pre></td></tr></table></figure>



<p>2ï¸âƒ£ ä¸Šé¢å°†é‡‡ç”¨æˆ‘ä»¬ä¸Šé¢çš„ <code>config1.toml</code> æ–‡ä»¶å¹¶å¯¹å…¶å†…å®¹è¿›è¡Œ <code>base64</code> ç¼–ç ï¼Œæ¸²æŸ“ä¼šå¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„ç»“æœï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ helm install --generate-name --dry-run ./mychart</span><br><span class="line"><span class="comment"># Source: mychart/templates/configmap.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Secret</span><br><span class="line">metadata:</span><br><span class="line">  name: mychart-1576048287-secret</span><br><span class="line"><span class="built_in">type</span>: Opaque</span><br><span class="line">data:</span><br><span class="line">  token: |-</span><br><span class="line">    bWVzc2FnZSA9IEhlbGxvIGZyb20gY29uZmlnIDEK</span><br></pre></td></tr></table></figure>

<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220409180156098.png" alt="image-20220409180156098"></p>
<p>æµ‹è¯•ç»“æŸã€‚ğŸ˜˜</p>
<h3 id="5-Lines"><a href="#5-Lines" class="headerlink" title="5.Lines"></a>5.Lines</h3><p>æœ‰æ—¶ï¼Œéœ€è¦è®¿é—®æ¨¡æ¿ä¸­æ–‡ä»¶çš„æ¯ä¸€è¡Œå†…å®¹ï¼ŒHelm ä¹Ÿæä¾›äº†æ–¹æ³•çš„ <code>Lines</code> æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>range</code> å‡½æ•°éå†æ¯è¡Œå†…å®¹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">some-file.txt:</span> &#123;&#123; <span class="string">range</span> <span class="string">.Files.Lines</span> <span class="string">&quot;foo/bar.txt&quot;</span> &#125;&#125;</span><br><span class="line">    &#123;&#123; <span class="string">.</span> &#125;&#125;&#123;&#123; <span class="string">end</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ Helm å®‰è£…çš„æ—¶å€™æ— æ³•å°†æ–‡ä»¶ä¼ é€’åˆ° chart å¤–éƒ¨ï¼Œæ‰€ä»¥ï¼Œå¦‚æœä½ è¦æ±‚ç”¨æˆ·æä¾›æ•°æ®çš„è¯ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ <code>helm install -f</code> æˆ–è€… <code>helm install --set</code> æ¥è·å–ã€‚</p>
<h2 id="8ã€NOTES-txt-æ–‡ä»¶"><a href="#8ã€NOTES-txt-æ–‡ä»¶" class="headerlink" title="8ã€NOTES.txt æ–‡ä»¶"></a>8ã€NOTES.txt æ–‡ä»¶</h2><p>åœ¨æœ¬èŠ‚ä¸­æˆ‘ä»¬å°†æ¥äº†è§£ä¸º chart ç”¨æˆ·æä¾›è¯´æ˜çš„ä¸€ä¸ª <code>NOTES.txt</code> æ–‡ä»¶ï¼Œåœ¨ chart å®‰è£…æˆ–è€…å‡çº§ç»“æŸæ—¶ï¼ŒHelm å¯ä»¥ä¸ºç”¨æˆ·æ‰“å°å‡ºä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ï¼Œä½¿ç”¨æ¨¡æ¿ä¹Ÿå¯ä»¥è‡ªå®šä¹‰è¿™äº›ä¿¡æ¯ã€‚</p>
<p>è¦å°†å®‰è£…è¯´æ˜æ·»åŠ åˆ° chart ä¸­ï¼Œåªéœ€è¦åˆ›å»ºä¸€ä¸ª <code>templates/NOTES.txt</code> æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶çº¯æ–‡æœ¬çš„ï¼Œä½†æ˜¯å¯ä»¥åƒæ¨¡æ¿ä¸€æ ·è¿›è¡Œå¤„ç†ï¼Œå¹¶å…·æœ‰æ‰€æœ‰å¸¸è§„æ¨¡æ¿çš„åŠŸèƒ½å’Œå¯ç”¨å¯¹è±¡ã€‚</p>
<table><tr><td bgcolor=yellow>ğŸ’˜ ç¤ºä¾‹ï¼šNOTES.txt-2022.4.9(æµ‹è¯•æˆåŠŸ)</td></tr></table>

<p>1ï¸âƒ£ ç°åœ¨è®©æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªç®€å•çš„ <code>templates/NOTES.txt</code> æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Thank</span> <span class="string">you</span> <span class="string">for</span> <span class="string">installing</span> &#123;&#123; <span class="string">.Chart.Name</span> &#125;&#125;<span class="string">.</span></span><br><span class="line"></span><br><span class="line"><span class="string">Your</span> <span class="string">release</span> <span class="string">is</span> <span class="string">named</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">.</span></span><br><span class="line"></span><br><span class="line"><span class="string">To</span> <span class="string">learn</span> <span class="string">more</span> <span class="string">about</span> <span class="string">the</span> <span class="string">release,</span> <span class="attr">try:</span></span><br><span class="line"></span><br><span class="line">  <span class="string">$</span> <span class="string">helm</span> <span class="string">status</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;</span><br><span class="line">  <span class="string">$</span> <span class="string">helm</span> <span class="string">get</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;</span><br></pre></td></tr></table></figure>



<p>2ï¸âƒ£ ç°åœ¨æˆ‘ä»¬è¿è¡Œ <code>helm install ./mychart</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨åº•éƒ¨çœ‹åˆ°è¿™æ ·çš„æ¶ˆæ¯ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">RESOURCES:</span><br><span class="line">==&gt; v1/Secret</span><br><span class="line">NAME                   TYPE      DATA      AGE</span><br><span class="line">rude-cardinal-secret   Opaque    1         0s</span><br><span class="line"></span><br><span class="line">==&gt; v1/ConfigMap</span><br><span class="line">NAME                      DATA      AGE</span><br><span class="line">rude-cardinal-configmap   3         0s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">NOTES:</span><br><span class="line">Thank you <span class="keyword">for</span> installing mychart.</span><br><span class="line"></span><br><span class="line">Your release is named rude-cardinal.</span><br><span class="line"></span><br><span class="line">To learn more about the release, try:</span><br><span class="line"></span><br><span class="line">  $ helm status rude-cardinal</span><br><span class="line">  $ helm get rude-cardinal</span><br></pre></td></tr></table></figure>

<p>ç”¨è¿™ç§æ–¹å¼å¯ä»¥å‘ç”¨æˆ·æä¾›ä¸€ä¸ªæœ‰å…³å¦‚ä½•ä½¿ç”¨å…¶æ–°å®‰è£…çš„ chart çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¼ºçƒˆå»ºè®®åˆ›å»º <code>NOTES.txt</code> æ–‡ä»¶ï¼Œè™½ç„¶è¿™ä¸æ˜¯å¿…é¡»çš„ã€‚</p>
<p>æµ‹è¯•ç»“æŸã€‚ğŸ˜˜</p>
<h2 id="9ã€Subcharts-å’Œ-Global-Values"><a href="#9ã€Subcharts-å’Œ-Global-Values" class="headerlink" title="9ã€Subcharts å’Œ Global Values"></a>9ã€Subcharts å’Œ Global Values</h2><p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»å•ä¸€æ¨¡æ¿ï¼Œåˆ°å¤šä¸ªæ¨¡æ¿æ–‡ä»¶ï¼Œä½†æ˜¯éƒ½ä»…ä»…æ˜¯å¤„ç†çš„ä¸€ä¸ª chart åŒ…ï¼Œä½†æ˜¯ charts å¯èƒ½å…·æœ‰ä¸€äº›ä¾èµ–é¡¹ï¼Œæˆ‘ä»¬ç§°ä¸º <code>subchartsï¼ˆå­ chartï¼‰</code>ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå­ chartã€‚</p>
<p>åŒæ ·åœ¨æ·±å…¥äº†è§£ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸‹å­ chart ç›¸å…³çš„ä¸€äº›ä¿¡æ¯ã€‚</p>
<ul>
<li>å­ chart æ˜¯<strong>ç‹¬ç«‹</strong>çš„ï¼Œè¿™æ„å‘³ç€å­ chart ä¸èƒ½æ˜¾ç¤ºä¾èµ–å…¶çˆ¶ chart</li>
<li>æ‰€ä»¥å­ chart æ— æ³•è®¿é—®å…¶çˆ¶çº§çš„å€¼</li>
<li>çˆ¶ chart å¯ä»¥è¦†ç›–å­ chart çš„å€¼</li>
<li>Helm ä¸­æœ‰å¯ä»¥è¢«æ‰€æœ‰ charts è®¿é—®çš„å…¨å±€å€¼çš„æ¦‚å¿µ</li>
</ul>
<table><tr><td bgcolor=yellow>ğŸ’˜ ç¤ºä¾‹ï¼šSubchartså’ŒClobal Values-2022.4.9(æµ‹è¯•æˆåŠŸ)</td></tr></table>

<h3 id="1-åˆ›å»ºå­chart"><a href="#1-åˆ›å»ºå­chart" class="headerlink" title="1.åˆ›å»ºå­chart"></a>1.åˆ›å»ºå­chart</h3><p>åŒæ ·è¿˜æ˜¯åœ¨ä¹‹å‰æ“ä½œçš„ <code>mychart/</code> è¿™ä¸ª chart åŒ…ä¸­ï¼Œæˆ‘ä»¬æ¥å°è¯•æ·»åŠ ä¸€äº›æ–°çš„å­ chartï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">âœ <span class="built_in">cd</span> mychart/charts</span><br><span class="line">âœ helm create mysubchart</span><br><span class="line">Creating mysubchart</span><br><span class="line">âœ rm -rf mysubchart/templates/*.*</span><br><span class="line">âœ <span class="built_in">echo</span> &gt; mysubchart/values.yaml</span><br></pre></td></tr></table></figure>

<p>å’Œå‰é¢ä¸€æ ·ï¼Œæˆ‘ä»¬åˆ é™¤äº†æ‰€æœ‰çš„åŸºæœ¬æ¨¡æ¿ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥ä»å¤´å¼€å§‹ã€‚</p>
<h3 id="2-æ·»åŠ -values-å’Œ-æ¨¡æ¿"><a href="#2-æ·»åŠ -values-å’Œ-æ¨¡æ¿" class="headerlink" title="2.æ·»åŠ  values å’Œ æ¨¡æ¿"></a>2.æ·»åŠ  values å’Œ æ¨¡æ¿</h3><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸º mysubchart è¿™ä¸ªå­ chart åˆ›å»ºä¸€ä¸ªç®€å•çš„æ¨¡æ¿å’Œ values å€¼æ–‡ä»¶ï¼Œ<code>mychart/charts/mysubchart</code> ä¸­å·²ç»æœ‰ä¸€ä¸ª <code>values.yaml</code> æ–‡ä»¶äº†ï¼Œåœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢çš„ valuesï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dessert:</span> <span class="string">cake</span></span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªæ–°çš„ ConfigMap æ¨¡æ¿ <code>mychart/charts/mysubchart/templates/configmap.yaml</code>ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-cfgmap2</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">dessert:</span> &#123;&#123; <span class="string">.Values.dessert</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæ¯ä¸ªå­ chart éƒ½æ˜¯ç‹¬ç«‹çš„ chartï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å•ç‹¬æµ‹è¯• <code>mysubchart</code>ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">âœ  helm install --generate-name --dry-run ./mychart/charts/mysubchart </span><br><span class="line">WARNING: Kubernetes configuration file is group-readable. This is insecure. Location: /home/hg/.kube/config</span><br><span class="line">WARNING: Kubernetes configuration file is world-readable. This is insecure. Location: /home/hg/.kube/config</span><br><span class="line">NAME: mysubchart-1649500624</span><br><span class="line">LAST DEPLOYED: Sat Apr  9 18:37:05 2022</span><br><span class="line">NAMESPACE: default</span><br><span class="line">STATUS: pending-install</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">HOOKS:</span><br><span class="line">MANIFEST:</span><br><span class="line">---</span><br><span class="line"><span class="comment"># Source: mysubchart/templates/configmap.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: mysubchart-1649500624-cfgmap2</span><br><span class="line">data:</span><br><span class="line">  dessert: cake</span><br></pre></td></tr></table></figure>

<h3 id="3-ä»çˆ¶-chart-è¦†ç›–-values"><a href="#3-ä»çˆ¶-chart-è¦†ç›–-values" class="headerlink" title="3.ä»çˆ¶ chart è¦†ç›– values"></a>3.ä»çˆ¶ chart è¦†ç›– values</h3><p>æˆ‘ä»¬åŸæ¥çš„ chart - mychart ç°åœ¨æ˜¯ mysubchart çš„çˆ¶çº§ chart äº†ã€‚ç”±äº mychart æ˜¯çˆ¶çº§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ mychart ä¸­æŒ‡å®šé…ç½®ï¼Œå¹¶å°†è¯¥é…ç½®å‘é€åˆ° mysubchart ä¸­å»ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ä¿®æ”¹ <code>mychart/values.yaml</code>ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">favorite:</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">coffee</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">pizza</span></span><br><span class="line"><span class="attr">pizzaToppings:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">mushrooms</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cheese</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">peppers</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">onions</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mysubchart:</span></span><br><span class="line">  <span class="attr">dessert:</span> <span class="string">ice</span> <span class="string">cream</span></span><br></pre></td></tr></table></figure>

<p>æœ€åä¸¤è¡Œï¼Œ<code>mysubchart</code> éƒ¨åˆ†ä¸­çš„æ‰€æœ‰æŒ‡ä»¤éƒ½ä¼šè¢«å‘é€åˆ° <code>mysubchart</code> å­ chart ä¸­ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬ç°åœ¨æ¸²æŸ“æ¨¡æ¿ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>mysubchart</code> çš„ ConfigMap ä¼šè¢«æ¸²æŸ“æˆå¦‚ä¸‹çš„å†…å®¹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">âœ   helm install --generate-name --dry-run ./mychart <span class="comment">#æ³¨æ„ï¼šæœ¬æ¬¡æ˜¯ç›´æ¥æ¸²æŸ“çˆ¶chartsç›®å½•çš„</span></span><br><span class="line"><span class="comment"># Source: mychart/charts/mysubchart/templates/configmap.yaml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ConfigMap</span><br><span class="line">metadata:</span><br><span class="line">  name: mychart-1649500768-cfgmap2</span><br><span class="line">data:</span><br><span class="line">  dessert: ice cream</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°é¡¶å±‚çš„ values å€¼è¦†ç›–äº†å­ chart ä¸­çš„å€¼ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œæˆ‘ä»¬æ²¡æœ‰å°† <code>mychart/charts/mysubchart/templates/configmap.yaml</code> æ¨¡æ¿æ›´æ”¹ä¸ºæŒ‡å‘ <code>.Values.mysubchart.dessert</code>ï¼Œå› ä¸ºä»è¯¥æ¨¡æ¿çš„è§’åº¦æ¥çœ‹ï¼Œè¯¥å€¼ä»ç„¶ä½äº <code>.Values.dessert</code>ï¼Œå½“æ¨¡æ¿å¼•æ“ä¼ é€’ values å€¼çš„æ—¶å€™ï¼Œå®ƒä¼šè®¾ç½®è¿™ä¸ªä½œç”¨åŸŸï¼Œæ‰€ä»¥ï¼Œå¯¹äº <code>mysubchart</code> æ¨¡æ¿ï¼Œ<code>.Values</code> ä¸­ä»…ä»…æä¾›ç”¨äºè¯¥å­ chart çš„å€¼ã€‚</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220409184138057.png" alt="image-20220409184138057"></p>
<p>ä½†æ˜¯æœ‰æ—¶å€™å¦‚æœæˆ‘ä»¬ç¡®å®å¸Œæœ›æŸäº›å€¼å¯ä»¥ç”¨äºæ‰€æœ‰æ¨¡æ¿ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨å…¨å±€ chart values å€¼æ¥å®Œæˆäº†ã€‚</p>
<h3 id="4-å…¨å±€å€¼"><a href="#4-å…¨å±€å€¼" class="headerlink" title="4.å…¨å±€å€¼"></a>4.å…¨å±€å€¼</h3><p>å…¨å±€å€¼æ˜¯å¯ä»¥ä»ä»»ä½• chart æˆ–å­ chart ä¸­éƒ½å¯ä»¥è®¿é—®çš„å€¼ï¼Œå…¨å±€å€¼éœ€è¦æ˜¾ç¤ºçš„å£°æ˜ï¼Œ<strong>ä¸èƒ½å°†ç°æœ‰çš„éå…¨å±€å¯¹è±¡å½“ä½œå…¨å±€å¯¹è±¡ä½¿ç”¨</strong>ã€‚</p>
<p>Values æ•°æ®ç±»å‹å…·æœ‰ä¸€ä¸ªåä¸º <code>Values.global</code> çš„ä¿ç•™éƒ¨åˆ†ï¼Œå¯ä»¥åœ¨å…¶ä¸­è®¾ç½®å…¨å±€å€¼ï¼Œæˆ‘ä»¬åœ¨ <code>mychart/values.yaml</code> æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªå…¨å±€å€¼ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">favorite:</span></span><br><span class="line">  <span class="attr">drink:</span> <span class="string">coffee</span></span><br><span class="line">  <span class="attr">food:</span> <span class="string">pizza</span></span><br><span class="line"><span class="attr">pizzaToppings:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">mushrooms</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">cheese</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">peppers</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">onions</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mysubchart:</span></span><br><span class="line">  <span class="attr">dessert:</span> <span class="string">ice</span> <span class="string">cream</span></span><br><span class="line"></span><br><span class="line"><span class="attr">global:</span></span><br><span class="line">  <span class="attr">salad:</span> <span class="string">caesar</span></span><br></pre></td></tr></table></figure>

<p>ç”±äºå…¨å±€å€¼çš„åŸå› ï¼Œåœ¨ <code>mychart/templates/configmap.yaml</code> å’Œ <code>mysubchart/templates/configmap.yaml</code> ä¸‹é¢éƒ½åº”è¯¥å¯ä»¥ä»¥ <code>&#123;&#123; .Values.global.salad &#125;&#125;</code> çš„å½¢å¼æ¥è®¿é—®è¿™ä¸ªå€¼ã€‚</p>
<p><code>mychart/templates/configmap.yaml</code>ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">salad:</span> &#123;&#123; <span class="string">.Values.global.salad</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p><code>mysubchart/templates/configmap.yaml</code>:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> &#123;&#123; <span class="string">.Release.Name</span> &#125;&#125;<span class="string">-cfgmap2</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">dessert:</span> &#123;&#123; <span class="string">.Values.dessert</span> &#125;&#125;</span><br><span class="line">  <span class="attr">salad:</span> &#123;&#123; <span class="string">.Values.global.salad</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬æ¸²æŸ“è¿™ä¸ªæ¨¡æ¿ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„å†…å®¹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: mychart/charts/mysubchart/templates/configmap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1576053485-cfgmap2</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">dessert:</span> <span class="string">ice</span> <span class="string">cream</span></span><br><span class="line">  <span class="attr">salad:</span> <span class="string">caesar</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: mychart/templates/configmap.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">mychart-1576053485-configmap</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">salad:</span> <span class="string">caesar</span></span><br></pre></td></tr></table></figure>

<p>å…¨å±€å€¼å¯¹äºä¼ é€’è¿™æ ·çš„æ•°æ®æ¯”è¾ƒæœ‰ç”¨ã€‚</p>
<h3 id="5-å…±äº«æ¨¡æ¿"><a href="#5-å…±äº«æ¨¡æ¿" class="headerlink" title="5.å…±äº«æ¨¡æ¿"></a>5.å…±äº«æ¨¡æ¿</h3><p>çˆ¶çº§ chart å’Œå­ chart å¯ä»¥å…±äº«æ¨¡æ¿ï¼Œä»»ä½• chart ä¸­å·²å®šä¹‰çš„å—éƒ½å¯ä»¥ç”¨äºå…¶ä»– chartã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªç®€å•çš„æ¨¡æ¿ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;<span class="bullet">-</span> <span class="string">define</span> <span class="string">&quot;labels&quot;</span> &#125;&#125;<span class="attr">from:</span> <span class="string">mychart&#123;&#123;</span> <span class="string">end</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>å‰é¢æˆ‘ä»¬æåˆ°è¿‡å¯ä»¥ä½¿ç”¨åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ <code>include</code> å’Œ <code>template</code>ï¼Œä½†æ˜¯ä½¿ç”¨ <code>include</code> çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å¯ä»¥åŠ¨æ€å¼•å…¥æ¨¡æ¿çš„å†…å®¹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; <span class="string">include</span> <span class="string">$mytemplate</span> &#125;&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ä¼šå»ä½¿ç”¨å…±äº«æ¨¡æ¿ï¼Œå®¹æ˜“å†²çªã€‚</p>
</blockquote>
<p>æµ‹è¯•ç»“æŸã€‚ğŸ˜˜</p>
<h2 id="10ã€æ¨¡æ¿è°ƒè¯•"><a href="#10ã€æ¨¡æ¿è°ƒè¯•" class="headerlink" title="10ã€æ¨¡æ¿è°ƒè¯•"></a>10ã€æ¨¡æ¿è°ƒè¯•</h2><p>è°ƒè¯•æ¨¡æ¿å¯èƒ½æ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºæ¸²æŸ“çš„æ¨¡æ¿ä¼šå‘é€åˆ° Kubernetes API serverï¼Œè€Œ API server å¯èƒ½ä¼šå› ä¸ºæ ¼å¼ä»¥å¤–çš„ä¸€äº›åŸå› è€Œæ‹’ç» YAML æ–‡ä»¶ã€‚</p>
<p>ä¸‹é¢è¿™äº›å‘½ä»¤å¯ä»¥å¸®åŠ©ä½ è°ƒè¯•ä¸€äº›é—®é¢˜ï¼š</p>
<ul>
<li><p><code>helm lint</code> æ˜¯éªŒè¯ chart æ˜¯å¦éµå¾ªæœ€ä½³å®è·µçš„é¦–é€‰å·¥å…·</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220409190403340.png" alt="image-20220409190403340"></p>
</li>
<li><p><code>helm install --dry-run --debug</code> æˆ–è€… <code>helm template --debug</code>ï¼šå‰é¢æˆ‘ä»¬å·²ç»ä½¿ç”¨äº†è¿™ä¸ªæŠ€å·§ï¼Œè¿™ä¸ªæ˜¯è®©æœåŠ¡å™¨æ¸²æŸ“æ¨¡æ¿ï¼Œç„¶åè¿”å›ç”Ÿæˆçš„èµ„æºæ¸…å•æ–‡ä»¶çš„å¥½æ–¹æ³•ï¼Œè€Œä¸”ä¸ä¼šçœŸæ­£çš„å»å®‰è£…è¿™äº›èµ„æº</p>
</li>
<li><p><code>helm get manifest</code>ï¼šè¿™æ˜¯æŸ¥çœ‹æœåŠ¡å™¨ä¸Šå®‰è£…äº†å“ªäº›æ¨¡æ¿çš„å¥½æ–¹æ³•</p>
</li>
</ul>
<p>å½“ä½ çš„ YAML æ–‡ä»¶æ— æ³•è§£æçš„æ—¶å€™ï¼Œä½†ä½ æƒ³è¦æŸ¥çœ‹ç”Ÿæˆçš„å†…å®¹çš„æ—¶å€™ï¼Œæ£€ç´¢ YAML çš„ä¸€ç§ç®€å•æ–¹æ³•æ˜¯æ³¨é‡Šæ‰æ¨¡æ¿ä¸­çš„é—®é¢˜éƒ¨åˆ†ï¼Œç„¶åé‡æ–°è¿è¡Œ <code>helm install --dry-run --debug</code>ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v2</span></span><br><span class="line"><span class="comment"># some: problem section</span></span><br><span class="line"><span class="comment"># &#123;&#123; .Values.foo | quote &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šé¢çš„å†…å®¹å°†å‘ˆç°å¹¶è¿”å›å®Œæ•´çš„æ³¨é‡Šï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v2</span></span><br><span class="line"><span class="comment"># some: problem section</span></span><br><span class="line"><span class="comment">#  &quot;bar&quot;</span></span><br></pre></td></tr></table></figure>

<p>è¿™æä¾›äº†ä¸€ç§æŸ¥çœ‹ç”Ÿæˆçš„å†…å®¹çš„å¿«é€Ÿæ–¹æ³•ã€‚</p>
<h2 id="11ã€Chart-Hooks"><a href="#11ã€Chart-Hooks" class="headerlink" title="11ã€Chart Hooks"></a>11ã€Chart Hooks</h2><p>Helm ä¹Ÿæä¾›äº†ä¸€ç§ Hook æœºåˆ¶ï¼Œå¯ä»¥å…è®¸ chart å¼€å‘äººå‘˜åœ¨ release ç”Ÿå‘½å‘¨æœŸçš„æŸäº›æ—¶é—´ç‚¹è¿›è¡Œå¹²é¢„ã€‚æ¯”å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ hook æ¥è¿›è¡Œä¸‹é¢çš„æ“ä½œï¼š</p>
<ul>
<li>åœ¨åŠ è½½ä»»ä½• charts ä¹‹å‰ï¼Œåœ¨å®‰è£…çš„æ—¶å€™åŠ è½½ ConfigMap æˆ–è€… Secret</li>
<li>åœ¨å®‰è£…æ–°çš„ chart ä¹‹å‰ï¼Œæ‰§è¡Œä¸€ä¸ª Job æ¥å¤‡ä»½æ•°æ®åº“ï¼Œç„¶ååœ¨å‡çº§åæ‰§è¡Œç¬¬äºŒä¸ª Job è¿˜åŸæ•°æ®</li>
<li>åœ¨åˆ é™¤ release ä¹‹å‰è¿è¡Œä¸€ä¸ª JObï¼Œä»¥åœ¨åˆ é™¤ release ä¹‹å‰é€‚å½“åœ°å–æ¶ˆç›¸å…³æœåŠ¡</li>
</ul>
<p>Hooks çš„å·¥ä½œæ–¹å¼ç±»ä¼¼äºæ™®é€šçš„æ¨¡æ¿ï¼Œä½†æ˜¯ä»–ä»¬å…·æœ‰ç‰¹æ®Šçš„æ³¨è§£ï¼Œè¿™äº›æ³¨è§£ä½¿ Helm å¯ä»¥ç”¨ä¸åŒçš„æ–¹å¼æ¥ä½¿ç”¨ä»–ä»¬ã€‚</p>
<h3 id="1-Hooks"><a href="#1-Hooks" class="headerlink" title="1.Hooks"></a>1.Hooks</h3><p>åœ¨ Helm ä¸­å®šä¹‰äº†å¦‚ä¸‹ä¸€äº›å¯ä¾›æˆ‘ä»¬ä½¿ç”¨çš„ Hooksï¼š</p>
<ul>
<li>é¢„å®‰è£…<code>pre-install</code>ï¼šåœ¨æ¨¡æ¿æ¸²æŸ“åï¼Œkubernetes åˆ›å»ºä»»ä½•èµ„æºä¹‹å‰æ‰§è¡Œ</li>
<li>å®‰è£…å<code>post-install</code>ï¼šåœ¨æ‰€æœ‰ kubernetes èµ„æºå®‰è£…åˆ°é›†ç¾¤åæ‰§è¡Œ</li>
<li>é¢„åˆ é™¤<code>pre-delete</code>ï¼šåœ¨ä» kubernetes åˆ é™¤ä»»ä½•èµ„æºä¹‹å‰æ‰§è¡Œåˆ é™¤è¯·æ±‚</li>
<li>åˆ é™¤å<code>post-delete</code>ï¼šåˆ é™¤æ‰€æœ‰ release çš„èµ„æºåæ‰§è¡Œ</li>
<li>å‡çº§å‰<code>pre-upgrade</code>ï¼šåœ¨æ¨¡æ¿æ¸²æŸ“åï¼Œä½†åœ¨ä»»ä½•èµ„æºå‡çº§ä¹‹å‰æ‰§è¡Œ</li>
<li>å‡çº§å<code>post-upgrade</code>ï¼šåœ¨æ‰€æœ‰èµ„æºå‡çº§åæ‰§è¡Œ</li>
<li>é¢„å›æ»š<code>pre-rollback</code>ï¼šåœ¨æ¨¡æ¿æ¸²æŸ“åï¼Œåœ¨ä»»ä½•èµ„æºå›æ»šä¹‹å‰æ‰§è¡Œ</li>
<li>å›æ»šå<code>post-rollback</code>ï¼šåœ¨ä¿®æ”¹æ‰€æœ‰èµ„æºåæ‰§è¡Œå›æ»šè¯·æ±‚</li>
<li>æµ‹è¯•<code>test</code>ï¼šåœ¨è°ƒç”¨ Helm <code>test</code> å­å‘½ä»¤çš„æ—¶å€™æ‰§è¡Œï¼ˆå¯ä»¥æŸ¥çœ‹<a target="_blank" rel="noopener" href="https://helm.sh/docs/chart_tests/">æµ‹è¯•æ–‡æ¡£</a>ï¼‰</li>
</ul>
<h3 id="2-ç”Ÿå‘½å‘¨æœŸ"><a href="#2-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="2.ç”Ÿå‘½å‘¨æœŸ"></a>2.ç”Ÿå‘½å‘¨æœŸ</h3><p>Hooks å…è®¸å¼€å‘äººå‘˜åœ¨ release çš„ç”Ÿå‘½å‘¨æœŸä¸­çš„ä¸€äº›å…³é”®èŠ‚ç‚¹æ‰§è¡Œä¸€äº›é’©å­å‡½æ•°ï¼Œæˆ‘ä»¬æ­£å¸¸å®‰è£…ä¸€ä¸ª chart åŒ…çš„æ—¶å€™çš„ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<ol>
<li>ç”¨æˆ·è¿è¡Œ <code>helm install foo</code></li>
<li>Helm åº“æ–‡ä»¶è°ƒç”¨å®‰è£… API</li>
<li>ç»è¿‡ä¸€äº›éªŒè¯ï¼ŒHelm åº“æ¸²æŸ“ <code>foo</code> æ¨¡æ¿</li>
<li>Helm åº“å°†äº§ç”Ÿçš„èµ„æºåŠ è½½åˆ° kubernetes ä¸­å»</li>
<li>Helm åº“å°† release å¯¹è±¡å’Œå…¶ä»–æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯</li>
<li>Helm å®¢æˆ·ç«¯é€€å‡º</li>
</ol>
<p>å¦‚æœå¼€å‘äººå‘˜åœ¨ <code>install</code> çš„ç”Ÿå‘½å‘¨æœŸä¸­å®šä¹‰äº†ä¸¤ä¸ª hookï¼š<code>pre-install</code>å’Œ<code>post-install</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®‰è£…ä¸€ä¸ª chart åŒ…çš„ç”Ÿå‘½å‘¨æœŸå°±ä¼šå¤šä¸€äº›æ­¥éª¤äº†ï¼š</p>
<ol>
<li>ç”¨æˆ·è¿è¡Œ<code>helm install foo</code></li>
<li>Helm åº“æ–‡ä»¶è°ƒç”¨å®‰è£… API</li>
<li>åœ¨ <code>crds/</code> ç›®å½•ä¸‹é¢çš„ CRDs è¢«å®‰è£…</li>
<li>ç»è¿‡ä¸€äº›éªŒè¯ï¼ŒHelm åº“æ¸²æŸ“ <code>foo</code> æ¨¡æ¿</li>
<li>Helm åº“å°† hook èµ„æºåŠ è½½åˆ° kubernetes ä¸­ï¼Œå‡†å¤‡æ‰§è¡Œ<code>pre-install</code> hooks</li>
<li>Helm åº“ä¼šæ ¹æ®æƒé‡å¯¹ hooks è¿›è¡Œæ’åºï¼ˆé»˜è®¤åˆ†é…æƒé‡0ï¼Œæƒé‡ç›¸åŒçš„ hook æŒ‰å‡åºæ’åºï¼‰</li>
<li>Helm åº“ç„¶ååŠ è½½æœ€ä½æƒé‡çš„ hook</li>
<li>Helm åº“ä¼šç­‰å¾…ï¼Œç›´åˆ° hook å‡†å¤‡å°±ç»ª</li>
<li>Helm åº“å°†äº§ç”Ÿçš„èµ„æºåŠ è½½åˆ° kubernetes ä¸­ï¼Œæ³¨æ„å¦‚æœæ·»åŠ äº† <code>--wait</code> å‚æ•°ï¼ŒHelm åº“ä¼šç­‰å¾…æ‰€æœ‰èµ„æºéƒ½å‡†å¤‡å¥½ï¼Œåœ¨è¿™ä¹‹å‰ä¸ä¼šè¿è¡Œ <code>post-install</code> hook</li>
<li>Helm åº“æ‰§è¡Œ <code>post-install</code> hookï¼ˆåŠ è½½ hook èµ„æºï¼‰</li>
<li>Helm åº“ç­‰å¾…ï¼Œç›´åˆ° hook å‡†å¤‡å°±ç»ª</li>
<li>Helm åº“å°† release å¯¹è±¡å’Œå…¶ä»–æ•°æ®è¿”å›ç»™å®¢æˆ·ç«¯</li>
<li>Helm å®¢æˆ·ç«¯é€€å‡º</li>
</ol>
<p>ç­‰å¾… hook å‡†å¤‡å°±ç»ªï¼Œè¿™æ˜¯ä¸€ä¸ªé˜»å¡çš„æ“ä½œï¼Œå¦‚æœ hook ä¸­å£°æ˜çš„æ˜¯ä¸€ä¸ª Job èµ„æºï¼ŒHelm å°†ç­‰å¾… Job æˆåŠŸå®Œæˆï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™å‘å¸ƒå¤±è´¥ï¼Œåœ¨è¿™ä¸ªæœŸé—´ï¼ŒHelm å®¢æˆ·ç«¯æ˜¯å¤„äºæš‚åœçŠ¶æ€çš„ã€‚</p>
<p>å¯¹äºæ‰€æœ‰å…¶ä»–ç±»å‹ï¼Œåªè¦ kubernetes å°†èµ„æºæ ‡è®°ä¸ºåŠ è½½ï¼ˆæ·»åŠ æˆ–æ›´æ–°ï¼‰ï¼Œèµ„æºå°±è¢«è§†ä¸ºå°±ç»ªçŠ¶æ€ï¼Œå½“ä¸€ä¸ª hook å£°æ˜äº†å¾ˆå¤šèµ„æºæ˜¯ï¼Œè¿™äº›èµ„æºæ˜¯è¢«ä¸²è¡Œæ‰§è¡Œçš„ã€‚</p>
<p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ hook åˆ›å»ºçš„èµ„æºä¸ä¼šä½œä¸º release çš„ä¸€éƒ¨åˆ†è¿›è¡Œè·Ÿè¸ªå’Œç®¡ç†ï¼Œä¸€æ—¦ Helm éªŒè¯äº† hook å·²ç»è¾¾åˆ°äº†å°±ç»ªçŠ¶æ€ï¼Œå®ƒå°±ä¸ä¼šå»ç®¡å®ƒäº†ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ hook ä¸­åˆ›å»ºäº†èµ„æºï¼Œé‚£ä¹ˆä¸èƒ½ä¾èµ– <code>helm uninstall</code> å»åˆ é™¤èµ„æºï¼Œå› ä¸º hook åˆ›å»ºçš„èµ„æºå·²ç»ä¸å—æ§åˆ¶äº†ï¼Œè¦é”€æ¯è¿™äº›èµ„æºï¼Œä½ éœ€è¦å°† <code>helm.sh/hook-delete-policy</code> è¿™ä¸ª annotation æ·»åŠ åˆ° hook æ¨¡æ¿æ–‡ä»¶ä¸­ï¼Œæˆ–è€…è®¾ç½® <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/workloads/controllers/ttlafterfinished/">Job èµ„æºçš„ç”Ÿå­˜ï¼ˆTTLï¼‰å­—æ®µ</a>ã€‚</p>
<h3 id="3-ç¼–å†™-Hook"><a href="#3-ç¼–å†™-Hook" class="headerlink" title="3.ç¼–å†™ Hook"></a>3.ç¼–å†™ Hook</h3><table><tr><td bgcolor=yellow>ğŸ’˜ ç¤ºä¾‹ï¼šç¼–å†™hook-2022.4.10(æµ‹è¯•æˆåŠŸ)</td></tr></table>

<p>Hooks å°±æ˜¯ Kubernetes èµ„æºæ¸…å•æ–‡ä»¶ï¼Œåœ¨å…ƒæ•°æ®éƒ¨åˆ†å¸¦æœ‰ä¸€äº›ç‰¹æ®Šçš„æ³¨è§£ï¼Œå› ä¸ºä»–ä»¬æ˜¯æ¨¡æ¿æ–‡ä»¶ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨æ™®é€šæ¨¡æ¿æ‰€æœ‰çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬è¯»å– <code>.Values</code>ã€<code>.Release</code> å’Œ <code>.Template</code>ã€‚</p>
<p>1ï¸âƒ£ ä¾‹å¦‚ï¼Œåœ¨ <code>templates/post-install-job.yaml</code> æ–‡ä»¶ä¸­å£°æ˜ä¸€ä¸ª post-install çš„ hookï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; .Release.Name &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app.kubernetes.io/managed-by:</span> &#123;&#123; <span class="string">.Release.Service</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">    <span class="attr">app.kubernetes.io/instance:</span> &#123;&#123; <span class="string">.Release.Name</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">    <span class="attr">app.kubernetes.io/version:</span> &#123;&#123; <span class="string">.Chart.AppVersion</span> &#125;&#125;</span><br><span class="line">    <span class="attr">helm.sh/chart:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; .Chart.Name &#125;&#125;</span>-<span class="template-variable">&#123;&#123; .Chart.Version &#125;&#125;</span>&quot;</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="comment"># å› ä¸ºæ·»åŠ äº†è¿™ä¸ª hookï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™ä¸ªèµ„æºè¢«å®šä¹‰ä¸ºäº† hook</span></span><br><span class="line">    <span class="comment"># å¦‚æœæ²¡æœ‰è¿™è¡Œï¼Œåˆ™å½“å‰è¿™ä¸ª Job ä¼šè¢«å½“æˆ release çš„ä¸€éƒ¨åˆ†å†…å®¹ã€‚</span></span><br><span class="line">    <span class="attr">&quot;helm.sh/hook&quot;:</span> <span class="string">post-install</span></span><br><span class="line">    <span class="attr">&quot;helm.sh/hook-weight&quot;:</span> <span class="string">&quot;-5&quot;</span></span><br><span class="line">    <span class="comment">#&quot;helm.sh/hook-delete-policy&quot;: hook-succeeded</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; .Release.Name &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app.kubernetes.io/managed-by:</span> &#123;&#123; <span class="string">.Release.Service</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">        <span class="attr">app.kubernetes.io/instance:</span> &#123;&#123; <span class="string">.Release.Name</span> <span class="string">|</span> <span class="string">quote</span> &#125;&#125;</span><br><span class="line">        <span class="attr">helm.sh/chart:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; .Chart.Name &#125;&#125;</span>-<span class="template-variable">&#123;&#123; .Chart.Version &#125;&#125;</span>&quot;</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">post-install-job</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">&quot;alpine:3.3&quot;</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;/bin/sleep&quot;</span>,<span class="string">&quot;<span class="template-variable">&#123;&#123; default &quot;10&quot; .Values.sleepyTime &#125;&#125;</span>&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>å½“å‰è¿™ä¸ªæ¨¡æ¿æˆä¸º hook çš„åŸå› å°±æ˜¯æ·»åŠ è¿™ä¸ªæ³¨è§£ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">annotations:</span></span><br><span class="line">  <span class="attr">&quot;helm.sh/hook&quot;:</span> <span class="string">post-install</span></span><br></pre></td></tr></table></figure>



<p>2ï¸âƒ£ ç»™values.yamlæ·»åŠ å¦‚ä¸‹å†…å®¹</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#values.yaml</span></span><br><span class="line"><span class="string">â€¦â€¦</span></span><br><span class="line"><span class="attr">sleepyTime:</span> <span class="number">5</span></span><br></pre></td></tr></table></figure>



<p>3ï¸âƒ£ å®‰è£…å¹¶æµ‹è¯•</p>
<p><code>âœ  local-vscode helm install test ./mychart</code></p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220410084241719.png" alt="image-20220410084241719"></p>
<p>4ï¸âƒ£ ä¸€ç§èµ„æºä¹Ÿå¯ä»¥å®ç°å¤šä¸ª hooksï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">annotations:</span></span><br><span class="line">  <span class="attr">&quot;helm.sh/hook&quot;:</span> <span class="string">post-install,post-upgrade</span></span><br></pre></td></tr></table></figure>

<p>ç±»ä¼¼çš„ï¼Œå®ç°ç»™å®š hook çš„èµ„æºæ•°é‡ä¹Ÿæ²¡æœ‰é™åˆ¶ï¼Œæ¯”å¦‚å¯ä»¥å°† secret å’Œä¸€ä¸ª configmap éƒ½å£°æ˜ä¸º <code>pre-install</code> hookã€‚</p>
<p>å½“å­ chart å£°æ˜ hooks çš„æ—¶å€™ï¼Œä¹Ÿä¼šå¯¹å…¶è¿›è¡Œè°ƒç”¨ï¼Œé¡¶å±‚çš„ chart æ— æ³•ç¦ç”¨å­ chart æ‰€å£°æ˜çš„ hooksã€‚å¯ä»¥ä¸º hooks å®šä¹‰æƒé‡ï¼Œè¿™å°†æœ‰åŠ©äºç¡®å®š hooks çš„æ‰§è¡Œé¡ºåºï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">annotations:</span></span><br><span class="line">  <span class="attr">&quot;helm.sh/hook-weight&quot;:</span> <span class="string">&quot;5&quot;</span></span><br></pre></td></tr></table></figure>

<p>hook æƒé‡å¯ä»¥æ˜¯æ­£æ•°ä¹Ÿå¯ä»¥æ˜¯è´Ÿæ•°ï¼Œä½†æ˜¯å¿…é¡»ç”¨å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå½“ Helm å¼€å§‹æ‰§è¡Œç‰¹å®šç§ç±»çš„ hooks çš„æ—¶å€™ï¼Œå®ƒå°†ä»¥å‡åºçš„æ–¹å¼å¯¹è¿™äº› hooks è¿›è¡Œæ’åºã€‚</p>
<h3 id="4-Hook-åˆ é™¤ç­–ç•¥"><a href="#4-Hook-åˆ é™¤ç­–ç•¥" class="headerlink" title="4.Hook åˆ é™¤ç­–ç•¥"></a>4.Hook åˆ é™¤ç­–ç•¥</h3><p>æˆ‘ä»¬è¿˜å¯ä»¥å®šä¹‰ç¡®å®šä½•æ—¶åˆ é™¤ç›¸åº” hook èµ„æºçš„ç­–ç•¥ï¼Œhook åˆ é™¤ç­–ç•¥å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ³¨è§£è¿›è¡Œå®šä¹‰ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">annotations:</span></span><br><span class="line">  <span class="attr">&quot;helm.sh/hook-delete-policy&quot;:</span> <span class="string">before-hook-creation,hook-succeeded</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªå·²å®šä¹‰çš„æ³¨è§£ï¼š</p>
<ul>
<li><code>before-hook-creation</code>ï¼šè¿è¡Œä¸€ä¸ªæ–°çš„ hook ä¹‹å‰åˆ é™¤å‰é¢çš„èµ„æºï¼ˆé»˜è®¤ï¼‰</li>
<li><code>hook-succeeded</code>ï¼šhook æˆåŠŸæ‰§è¡Œååˆ é™¤èµ„æº</li>
<li><code>hook-failed</code>ï¼šhook å¦‚æœæ‰§è¡Œå¤±è´¥åˆ™åˆ é™¤èµ„æº</li>
</ul>
<p>å¦‚æœæœªæŒ‡å®šä»»ä½• hook åˆ é™¤ç­–ç•¥æ³¨è§£ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹ä¼šä½¿ç”¨ <code>before-hook-creation</code> ç­–ç•¥ã€‚</p>
<h2 id="å…³äºæˆ‘"><a href="#å…³äºæˆ‘" class="headerlink" title="å…³äºæˆ‘"></a>å…³äºæˆ‘</h2><p>æˆ‘çš„åšå®¢ä¸»æ—¨ï¼šæˆ‘å¸Œæœ›æ¯ä¸€ä¸ªäººæ‹¿ç€æˆ‘çš„åšå®¢éƒ½å¯ä»¥åšå‡ºå®éªŒç°è±¡ï¼Œå…ˆæŠŠå®éªŒåšå‡ºæ¥ï¼Œç„¶åå†ç»“åˆç†è®ºçŸ¥è¯†æ›´æ·±å±‚æ¬¡å»ç†è§£æŠ€æœ¯ç‚¹ï¼Œè¿™æ ·å­¦ä¹ èµ·æ¥æ‰æœ‰ä¹è¶£å’ŒåŠ¨åŠ›ã€‚å¹¶ä¸”ï¼Œæˆ‘çš„åšå®¢å†…å®¹æ­¥éª¤æ˜¯å¾ˆå®Œæ•´çš„ï¼Œä¹Ÿåˆ†äº«æºç å’Œå®éªŒç”¨åˆ°çš„è½¯ä»¶ï¼Œå¸Œæœ›èƒ½å’Œå¤§å®¶ä¸€èµ·å…±åŒè¿›æ­¥ï¼</p>
<p>å„ä½å°ä¼™ä¼´åœ¨å®é™…æ“ä½œè¿‡ç¨‹ä¸­å¦‚æœ‰ä»€ä¹ˆç–‘é—®ï¼Œå¯éšæ—¶è”ç³»æœ¬äººå…è´¹å¸®æ‚¨è§£å†³é—®é¢˜ï¼š</p>
<ol>
<li><p>ä¸ªäººå¾®ä¿¡äºŒç»´ç ï¼šx2675263825 ï¼ˆèˆå¾—ï¼‰ï¼Œ qqï¼š2675263825ã€‚</p>
<p> <img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/20211106144206.png" alt="image-20211002091450217"></p>
</li>
<li><p>ä¸ªäººå¾®ä¿¡å…¬ä¼—å·ï¼šäº‘åŸç”Ÿæ¶æ„å¸ˆå®æˆ˜</p>
<p> <img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/20211106144224.png" alt="image-20211002141739664"></p>
</li>
<li><p>ä¸ªäººåšå®¢åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://www.onlyonexl.cn/">www.onlyonexl.cn</a></p>
<p> <img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/20211106144213.png" alt="image-20211002092057988"></p>
</li>
<li><p>ä¸ªäººcsdn</p>
<p> <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39246554?spm=1010.2135.3001.5421">https://blog.csdn.net/weixin_39246554?spm=1010.2135.3001.5421</a></p>
<p> <img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/20211106144230.png" alt="image-20211002092344616"></p>
</li>
<li><p>ä¸ªäººå·²å¼€æºå¹²è´§ğŸ˜˜</p>
<table>
<thead>
<tr>
<th align="left">åç§°</th>
<th align="left">é“¾æ¥</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><font color=red><strong>å®æˆ˜ï¼šæ‰“é€ ä¸€æ¬¾ç‹è€…äº‘ç¬”è®°ï¼štypora+åšæœäº‘+é˜¿é‡Œäº‘oss &amp; å®šåˆ¶å®‡å®™ä¸­æœ€ç¾çš„typoraä¸»é¢˜çš®è‚¤ &amp;Â ç©è½¬vscode</strong></font>(æ°¸ä¹…å¼€æº)</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.jianguoyun.com/p/DXS6qiIQvPWVCRiS0qoE">https://www.jianguoyun.com/p/DXS6qiIQvPWVCRiS0qoE</a></td>
</tr>
</tbody></table>
</li>
</ol>
<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>å¥½äº†ï¼Œå…³äºhelmæ¨¡æ¿å¼€å‘å°±åˆ°è¿™é‡Œäº†ï¼Œæ„Ÿè°¢å¤§å®¶é˜…è¯»ï¼Œæœ€åè´´ä¸Šæˆ‘å¥³ç¥çš„photoï¼Œç¥å¤§å®¶ç”Ÿæ´»å¿«ä¹ï¼Œæ¯å¤©éƒ½è¿‡çš„æœ‰æ„ä¹‰å“¦ï¼Œæˆ‘ä»¬ä¸‹æœŸè§ï¼</p>
<p><img src="https://bucket-hg.oss-cn-shanghai.aliyuncs.com/img/image-20220410084957142.png" alt="image-20220410084957142"></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        æ–‡ç« ä½œè€…:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">ä¸€ä¸ªäºº</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        æ–‡ç« é“¾æ¥:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://www.onlyyou520.com/2022/04/10/143%20Helm%E6%A8%A1%E6%9D%BF%E5%BC%80%E5%8F%91/">https://www.onlyyou520.com/2022/04/10/143%20Helm%E6%A8%A1%E6%9D%BF%E5%BC%80%E5%8F%91/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        ç‰ˆæƒå£°æ˜:
                    </i>
                </span>
                <span class="reprint-info">
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ¥å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº
                    <a href="/about" target="_blank">ä¸€ä¸ªäºº</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>å¤åˆ¶æˆåŠŸï¼Œè¯·éµå¾ªæœ¬æ–‡çš„è½¬è½½è§„åˆ™</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">æŸ¥çœ‹</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/k8s/">
                                    <span class="chip bg-color">k8s</span>
                                </a>
                            
                                <a href="/tags/helm/">
                                    <span class="chip bg-color">helm</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>å¾®ä¿¡æ‰«ä¸€æ‰«å³å¯åˆ†äº«ï¼</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">èµ</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">ä½ çš„èµè¯†æ˜¯æˆ‘å‰è¿›çš„åŠ¨åŠ›</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">æ”¯ä»˜å®</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">å¾® ä¿¡</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç ">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="å¾®ä¿¡æ‰“èµäºŒç»´ç ">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;ä¸Šä¸€ç¯‡</div>
            <div class="card">
                <a href="/2022/04/16/144%20Devops%E7%90%86%E8%AE%BA%E4%B8%8E%E5%9F%BA%E7%A1%80-2022.4.15(%E5%8D%9A%E5%AE%A2%E5%8F%91%E5%B8%83)/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/5.jpg" class="responsive-img" alt="Devopsç†è®ºä¸åŸºç¡€">
                        
                        <span class="card-title">Devopsç†è®ºä¸åŸºç¡€</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-04-16
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/devops/" class="post-category">
                                    devops
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/devops/">
                        <span class="chip bg-color">devops</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                ä¸‹ä¸€ç¯‡&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/04/07/142%20%E5%A6%82%E4%BD%95%E5%B0%86Git%E4%BB%93%E5%BA%93%E5%A4%87%E4%BB%BD%E5%88%B0%E6%9C%AC%E5%9C%B0%EF%BC%9F/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/17.jpg" class="responsive-img" alt="å¦‚ä½•å°†Gitä»“åº“å¤‡ä»½åˆ°æœ¬åœ°">
                        
                        <span class="card-title">å¦‚ä½•å°†Gitä»“åº“å¤‡ä»½åˆ°æœ¬åœ°</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-04-07
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/git/" class="post-category">
                                    git
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/git/">
                        <span class="chip bg-color">git</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- ä»£ç å—åŠŸèƒ½ä¾èµ– -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- ä»£ç è¯­è¨€ -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- ä»£ç å—å¤åˆ¶ -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- ä»£ç å—æ”¶ç¼© -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;ç›®å½•</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC æ‚¬æµ®æŒ‰é’®. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* ä¿®å¤æ–‡ç« å¡ç‰‡ div çš„å®½åº¦. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // åˆ‡æ¢TOCç›®å½•å±•å¼€æ”¶ç¼©çš„ç›¸å…³æ“ä½œ.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2022</span>
            
            <span id="year">2019</span>
            <a href="/about" target="_blank">ä¸€ä¸ªäºº</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;æ€»è®¿é—®é‡:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;æ€»è®¿é—®äººæ•°:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- è¿è¡Œå¤©æ•°æé†’. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/OnlyOnexl" class="tooltipped" target="_blank" data-tooltip="è®¿é—®æˆ‘çš„GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:2675263825@qq.com" class="tooltipped" target="_blank" data-tooltip="é‚®ä»¶è”ç³»æˆ‘" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2675263825" class="tooltipped" target="_blank" data-tooltip="QQè”ç³»æˆ‘: 2675263825" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS è®¢é˜…" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- æœç´¢é®ç½©æ¡† -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;æœç´¢</span>
            <input type="search" id="searchInput" name="s" placeholder="è¯·è¾“å…¥æœç´¢çš„å…³é”®å­—"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--è…¾è®¯å…”å°å·¢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
